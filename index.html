<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=6.0, user-scalable=yes" />
  <title>VizualNetwork - Next Gen Proxy Platform</title>
  
  <!-- Meta Tags -->
  <meta name="description" content="Launch into VizualNetwork, the next generation proxy platform with advanced features and modern design.">
  <meta name="keywords" content="Proxy, Unblocker, VizualNetwork, Web Proxy, Secure Browsing, Privacy">
  <meta property="og:image" content="/assets/logo.webp">
  
  <!-- Google Analytics -->
  <meta name="google-adsense-account" content="ca-pub-3747175608041884">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3DTW1KTNCF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-3DTW1KTNCF');
  </script>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Orbitron:wght@600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..400,0..1">
  
  <!-- External Libraries -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script src="/js/localforage.min.js"></script>
  
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico">

  <!-- Enhanced LocalStorage System for Google Slides -->
  <script>
    // Enhanced LocalStorage system that works in Google Slides
    window.firebase = null; // Disable Firebase for Google Slides compatibility
  </script>

  <style>
    :root {
      --viz: #0F468B;
      --viz-600: #1356ab;
      --viz-300: #64a0ff;
      --ink: #0b1220;
      --panel: #0e1a2e;
      --edge: rgba(255,255,255,.08);
      --text: #d9e9ff;
      --muted: #8fb0d9;
      --radius: 20px;
      --speed: 300ms;
      --primary: #a04cff;
      --secondary: #00d4ff;
      --accent: #ff6b6b;
    }

    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 70% -10%, rgba(100,160,255,.16), transparent 60%),
                  radial-gradient(900px 600px at -10% 10%, rgba(15,70,139,.25), transparent 50%),
                  linear-gradient(180deg, #0a1222 0%, #070c17 100%);
      min-height: 100dvh;
      overflow-x: hidden;
      position: relative;
    }

    /* ===== PARTICLE BACKGROUND ===== */
    canvas#particle-network {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    /* ===== Dynamic Island Navigation ===== */
    .nav-wrap {
      position: sticky;
      top: 20px;
      display: flex;
      justify-content: center;
      z-index: 50;
      margin-bottom: 40px;
      padding: 0 16px;
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      background: rgba(10,15,25,0.65);
      backdrop-filter: blur(25px) saturate(180%);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 999px;
      box-shadow: 
        0 8px 32px rgba(15,70,139,.3), 
        inset 0 1px 0 rgba(255,255,255,.1),
        0 0 0 1px rgba(100,160,255,.1);
      padding: 0 24px;
      height: 56px;
      min-width: 80px;
      transition: all 0.5s cubic-bezier(.25,.8,.25,1);
      overflow: hidden;
      cursor: pointer;
    }

    .nav:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 12px 40px rgba(15,70,139,.4), 
        inset 0 1px 0 rgba(255,255,255,.15),
        0 0 0 1px rgba(100,160,255,.2);
    }

    .nav-header {
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.4s cubic-bezier(.25,.8,.25,1);
    }

    .nav-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--viz-300);
      font-size: 24px;
      transition: all 0.3s ease;
    }

    .nav:hover .nav-logo {
      color: #fff;
      transform: scale(1.1);
      text-shadow: 0 0 20px rgba(100,160,255,.6);
    }

    .nav-label {
      font-weight: 700;
      font-size: 14px;
      color: var(--muted);
      opacity: 0;
      transform: translateX(-10px);
      transition: all 0.4s cubic-bezier(.25,.8,.25,1) 0.1s;
      letter-spacing: 0.5px;
    }

    .nav.open .nav-label {
      opacity: 1;
      transform: translateX(0);
    }

    .nav.open {
      min-width: min(95vw, 1000px);
      height: 88px;
      border-radius: 32px;
      justify-content: space-between;
      padding: 0 36px;
      background: rgba(10,15,25,0.75);
      border: 1px solid rgba(255,255,255,0.15);
    }

    .nav.open:hover {
      transform: translateY(-3px);
    }

    .nav-menu {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      transform: translateY(25px) scale(0.9);
      opacity: 0;
      pointer-events: none;
      transition: all 0.5s cubic-bezier(.25,.8,.25,1) 0.1s;
    }

    .nav.open .nav-menu {
      transform: translateY(0) scale(1);
      opacity: 1;
      pointer-events: auto;
    }

    .nav-tab {
      padding: 8px 14px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(.25,.8,.25,1);
      cursor: pointer;
      text-decoration: none;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.08);
      white-space: nowrap;
    }

    .nav-tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.1), transparent);
      transition: left 0.5s ease;
    }

    .nav-tab:hover::before {
      left: 100%;
    }

    .nav-tab:hover {
      background: var(--viz-300);
      color: #fff;
      box-shadow: 
        0 8px 25px rgba(100,160,255,.4),
        inset 0 1px 0 rgba(255,255,255,.2);
      transform: translateY(-3px) scale(1.05);
      border-color: rgba(255,255,255,.2);
    }

    .nav-tab.active {
      background: var(--viz);
      color: #fff;
      box-shadow: 
        0 6px 20px rgba(100,160,255,.5),
        inset 0 1px 0 rgba(255,255,255,.3);
      transform: translateY(-2px);
    }

    .panic-btn:hover {
      background: linear-gradient(45deg, #ff3838, #ff2f2f) !important;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
    }

    .panic-btn:active {
      transform: translateY(0) scale(0.95);
    }

    .nav-ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(100,160,255,.3);
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
    }

    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* Tablet optimizations */
    @media (max-width: 1024px) {
      .nav-menu {
        gap: 12px;
      }
      
      .nav-tab {
        padding: 7px 12px;
        font-size: 12px;
      }
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      .nav-wrap {
        top: 10px;
        padding: 0 8px;
      }
      
      .nav {
        height: 50px;
        padding: 0 18px;
      }
      
      .nav.open {
        height: 75px;
        padding: 0 20px;
        min-width: calc(100vw - 16px);
      }
      
      .nav-menu {
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .nav-tab {
        padding: 6px 10px;
        font-size: 11px;
        border-radius: 12px;
      }
    }

    /* Small mobile optimizations */
    @media (max-width: 480px) {
      .nav.open {
        height: 70px;
        padding: 0 16px;
      }
      
      .nav-menu {
        gap: 8px;
      }
      
      .nav-tab {
        padding: 5px 8px;
        font-size: 10px;
        border-radius: 10px;
      }
      
      .nav-tab i {
        font-size: 10px !important;
        margin-right: 4px !important;
      }
    }

    /* ===== HEADER ===== */
    header {
      padding: 20px 16px 28px;
      text-align: center;
      position: relative;
    }

    .brand {
      font-family: Orbitron, Inter, sans-serif;
      text-transform: uppercase;
      letter-spacing: .25em;
      font-weight: 700;
      font-size: clamp(32px, 4vw, 48px);
      color: #fff;
      margin: 0;
    }

    .brand em {
      color: var(--viz-300);
      font-style: normal;
      text-shadow: 0 0 22px rgba(100,160,255,.35);
    }

    .tag {
      margin: 10px auto 0;
      max-width: 640px;
      color: var(--muted);
      font-weight: 500;
    }

    /* ===== HOLO EARTH ===== */
    .holo-earth {
      margin: 20px auto;
      width: 220px;
      height: 220px;
      position: relative;
      perspective: 1000px;
    }

    .holo-globe {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      transform-style: preserve-3d;
      background: radial-gradient(circle at 30% 30%, #0a1e33 0%, #031020 70%);
      box-shadow: 0 0 30px rgba(100,160,255,0.4), inset 0 0 20px rgba(100,160,255,0.2);
      overflow: hidden;
      animation: spin 20s linear infinite;
    }

    .holo-globe::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: url("https://upload.wikimedia.org/wikipedia/commons/6/68/BlueMarble-2001-2002.png") no-repeat center/cover;
      mix-blend-mode: screen;
      opacity: 0.7;
    }

    .holo-globe::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: repeating-linear-gradient(transparent 0 2px, rgba(100,160,255,0.12) 2px 4px);
      mix-blend-mode: overlay;
      opacity: 0.3;
      animation: scan 6s linear infinite;
    }

    .holo-rim {
      position: absolute;
      inset: -10px;
      border-radius: 50%;
      box-shadow: 0 0 40px 15px rgba(100,160,255,0.25);
      pointer-events: none;
    }

    @keyframes spin {
      from { transform: rotateY(0deg); }
      to { transform: rotateY(360deg); }
    }

    @keyframes scan {
      from { background-position-y: 0; }
      to { background-position-y: 100%; }
    }

    /* ===== MAIN CONTENT ===== */
    .container {
      width: min(1200px, 92vw);
      margin: 24px auto 80px;
    }

    .card {
      background: rgba(255,255,255,.03);
      border: 1px solid var(--edge);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: 0 0 30px rgba(15,70,139,.25);
      margin-bottom: 20px;
    }
    .card h2 {
      margin: 0 0 8px;
      font: 700 20px/1.2 Orbitron, Inter, sans-serif;
      color: #fff;
    }

    /* ===== GAMES GRID ===== */
    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .game-card {
      background: rgba(255,255,255,.03);
      border: 1px solid var(--edge);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all var(--speed) ease;
      cursor: pointer;
    }
    .game-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(15,70,139,.35);
    }
    .game-thumb {
      width: 100%;
      height: 160px;
      background: linear-gradient(135deg, #0F468B, #64a0ff);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 40px;
    }
    .game-info { padding: 15px; }
    .game-title { font-weight: 700; margin: 0 0 8px; color: #fff; }
    .game-desc { color: var(--muted); font-size: 14px; margin: 0 0 15px; }
    .play-btn {
      display: block;
      width: 100%;
      padding: 10px;
      background: var(--viz);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      text-align: center;
      text-decoration: none;
      transition: all var(--speed) ease;
    }
    .play-btn:hover {
      background: var(--viz-600);
      transform: translateY(-2px);
    }

    /* ===== FEATURE GRIDS ===== */
    .proxy-features, .tools-grid, .security-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .feature-card, .tool-card, .security-card {
      background: rgba(255,255,255,.03);
      border: 1px solid var(--edge);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all var(--speed) ease;
      cursor: pointer;
    }
    
    .feature-card:hover, .tool-card:hover, .security-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(15,70,139,.35);
    }
    
    .feature-icon, .tool-icon, .security-icon {
      width: 100%;
      height: 160px;
      background: linear-gradient(135deg, #0F468B, #64a0ff);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 48px;
    }
    
    .tool-icon {
      background: linear-gradient(135deg, var(--primary), #a04cff);
    }
    
    .security-icon {
      background: linear-gradient(135deg, var(--accent), #ff8a80);
    }
    
    .feature-info, .tool-info, .security-info { 
      padding: 20px; 
    }
    
    .feature-title, .tool-title, .security-title { 
      font-weight: 700; 
      margin: 0 0 12px; 
      color: #fff; 
      font-size: 18px;
    }
    
    .feature-desc, .tool-desc, .security-desc { 
      color: var(--muted); 
      font-size: 14px; 
      margin: 0 0 20px; 
      line-height: 1.5;
    }
    
    .feature-btn, .tool-btn, .security-btn {
      background: linear-gradient(45deg, var(--viz), var(--viz-300));
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--speed) ease;
      width: 100%;
    }
    
    .feature-btn:hover, .tool-btn:hover, .security-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(15,70,139,.4);
    }

    /* ===== COMING SOON CARDS ===== */
    .coming-soon {
      background: rgba(255,255,255,.03);
      border: 1px solid var(--edge);
      border-radius: var(--radius);
      padding: 40px 20px;
      text-align: center;
      grid-column: 1 / -1;
      max-width: 500px;
      margin: 0 auto;
    }
    .coming-soon i {
      font-size: 48px;
      color: var(--viz-300);
      margin-bottom: 20px;
      opacity: 0.7;
    }
    .coming-soon h3 {
      font: 700 24px/1.2 Orbitron, Inter, sans-serif;
      color: #fff;
      margin: 0 0 15px;
    }
    .coming-soon p {
      color: var(--muted);
      font-size: 16px;
      margin: 0;
      line-height: 1.5;
    }

    /* ===== LOGIN MODAL ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: rgba(10,15,25,0.95);
      border: 1px solid var(--edge);
      border-radius: 24px;
      padding: 40px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(15,70,139,.4);
      backdrop-filter: blur(20px);
      position: relative;
    }

    .modal-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .modal-title {
      font-family: Orbitron, sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      margin: 0 0 8px;
    }

    .modal-subtitle {
      color: var(--muted);
      font-size: 14px;
      margin: 0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      color: var(--text);
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid var(--edge);
      border-radius: 12px;
      color: var(--text);
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--viz-300);
      box-shadow: 0 0 0 3px rgba(100,160,255,.1);
      background: rgba(255,255,255,.08);
    }

    .form-input::placeholder {
      color: var(--muted);
    }

    .btn-primary {
      width: 100%;
      padding: 12px;
      background: var(--viz);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 15px;
    }

    .btn-primary:hover {
      background: var(--viz-600);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(100,160,255,.4);
    }

    .btn-secondary {
      width: 100%;
      padding: 12px;
      background: transparent;
      color: var(--muted);
      border: 1px solid var(--edge);
      border-radius: 12px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-secondary:hover {
      background: rgba(255,255,255,.05);
      color: var(--text);
    }

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: var(--muted);
      font-size: 20px;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .close-modal:hover {
      color: #fff;
    }

    .form-switch {
      text-align: center;
      margin-top: 20px;
    }

    .form-switch a {
      color: var(--viz-300);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    .form-switch a:hover {
      color: #fff;
    }

    /* ===== PROFILE PAGE ===== */
    .profile-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--viz), var(--viz-300));
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      font-size: 32px;
      color: #fff;
      box-shadow: 0 8px 25px rgba(100,160,255,.4);
    }

    .profile-username {
      font-family: Orbitron, sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      margin: 0 0 5px;
    }

    .profile-level {
      color: var(--viz-300);
      font-weight: 600;
      font-size: 16px;
    }

    .xp-bar-container {
      background: rgba(255,255,255,.1);
      border-radius: 20px;
      height: 12px;
      margin: 20px 0;
      overflow: hidden;
    }

    .xp-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--viz), var(--viz-300));
      border-radius: 20px;
      transition: width 0.5s ease;
      position: relative;
    }

    .xp-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }

    .xp-text {
      text-align: center;
      color: var(--muted);
      font-size: 14px;
      margin-top: 8px;
    }

    .badges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .badge {
      background: rgba(255,255,255,.05);
      border: 1px solid var(--edge);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .badge.earned {
      background: rgba(100,160,255,.1);
      border-color: var(--viz-300);
      box-shadow: 0 4px 15px rgba(100,160,255,.2);
    }

    .badge-icon {
      font-size: 24px;
      margin-bottom: 8px;
      color: var(--muted);
    }

    .badge.earned .badge-icon {
      color: var(--viz-300);
    }

    .badge-name {
      font-size: 12px;
      font-weight: 600;
      color: var(--text);
      margin: 0;
    }

    .badge.earned .badge-name {
      color: #fff;
    }


    /* ===== FIREBASE STATUS ===== */
    .firebase-status {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      z-index: 1000;
      backdrop-filter: blur(10px);
      border: 1px solid var(--edge);
    }

    .firebase-status.connected {
      background: rgba(34,197,94,0.8);
      border-color: rgba(34,197,94,0.3);
    }

    .firebase-status.error {
      background: rgba(239,68,68,0.8);
      border-color: rgba(239,68,68,0.3);
    }

    .firebase-status.connecting {
      background: rgba(251,191,36,0.8);
      border-color: rgba(251,191,36,0.3);
    }

    /* ===== FOOTER ===== */
    footer {
      border-top: 1px solid var(--edge);
      padding: 20px;
      text-align: center;
      color: var(--muted);
      margin-top: 40px;
    }

    /* ===== ENHANCED BLOCKING EVASION STYLES ===== */
    
    /* Typewriter Animation */
    .typewriter {
      display: inline-block;
      border-right: 0.06em solid var(--primary);
      animation: blink-caret 1s step-end infinite;
    }

    @keyframes blink-caret {
      from, to { border-color: transparent; }
      50% { border-color: var(--primary); }
    }

    /* Blob Animations */
    .blob {
      position: absolute;
      border-radius: 50%;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      opacity: 0.1;
      animation: blob-move 20s infinite ease-in-out;
      z-index: -1;
    }

    .blob:nth-child(1) {
      width: 300px;
      height: 300px;
      top: 20%;
      left: 10%;
      animation-delay: 0s;
    }

    .blob:nth-child(2) {
      width: 200px;
      height: 200px;
      top: 60%;
      right: 20%;
      animation-delay: 5s;
    }

    .blob:nth-child(3) {
      width: 150px;
      height: 150px;
      bottom: 20%;
      left: 30%;
      animation-delay: 10s;
    }

    @keyframes blob-move {
      0%, 100% { transform: translate(0, 0) scale(1); }
      25% { transform: translate(50px, -50px) scale(1.1); }
      50% { transform: translate(-30px, 30px) scale(0.9); }
      75% { transform: translate(20px, -20px) scale(1.05); }
    }

    /* Proxy Browser Styles */
    .proxy-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: var(--ink);
      z-index: 100;
    }

    .proxy-header {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      background: var(--panel);
      border-bottom: 1px solid var(--edge);
      gap: 15px;
    }

    .proxy-url-bar {
      flex: 1;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--edge);
      border-radius: 25px;
      color: var(--text);
      font-size: 14px;
      outline: none;
    }

    .proxy-url-bar:focus {
      border-color: var(--viz-300);
      box-shadow: 0 0 0 2px rgba(100, 160, 255, 0.2);
    }

    .proxy-controls {
      display: flex;
      gap: 10px;
    }

    .proxy-btn {
      padding: 8px 12px;
      background: var(--viz);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .proxy-btn:hover {
      background: var(--viz-600);
      transform: translateY(-1px);
    }

    .proxy-iframe {
      width: 100%;
      height: calc(100vh - 70px);
      border: none;
      background: white;
    }

    /* Modern Toast Notifications - Theme Matched */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(14, 26, 46, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid var(--edge);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--text);
      font-family: Inter, system-ui, sans-serif;
      font-size: 13px;
      font-weight: 500;
      z-index: 10000;
      transform: translateX(-300px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05);
      max-width: 320px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.success {
      border-left: 3px solid var(--secondary);
      background: rgba(0, 212, 255, 0.1);
      color: var(--secondary);
    }

    .toast.error {
      border-left: 3px solid var(--accent);
      background: rgba(255, 107, 107, 0.1);
      color: var(--accent);
    }

    .toast.warning {
      border-left: 3px solid #ffaa00;
      background: rgba(255, 170, 0, 0.1);
      color: #ffaa00;
    }

    .toast.info {
      border-left: 3px solid var(--viz-300);
      background: rgba(100, 160, 255, 0.1);
      color: var(--viz-300);
    }

    .toast::before {
      content: "‚óè";
      font-size: 8px;
      opacity: 0.7;
    }

    .toast.success::before {
      content: "‚úì";
      font-size: 12px;
      color: var(--secondary);
    }

    .toast.error::before {
      content: "‚úï";
      font-size: 12px;
      color: var(--accent);
    }

    .toast.warning::before {
      content: "‚ö†";
      font-size: 12px;
      color: #ffaa00;
    }

    .toast.info::before {
      content: "‚Ñπ";
      font-size: 12px;
      color: var(--viz-300);
    }

    /* Remove cursor effect for cleaner look */
    .toast::after {
      display: none;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* Stack multiple toasts */
    .toast:nth-child(2) {
      bottom: 50px;
    }

    .toast:nth-child(3) {
      bottom: 80px;
    }

    .toast:nth-child(4) {
      bottom: 110px;
    }

    .toast:nth-child(5) {
      bottom: 140px;
    }

    /* Enhanced Animations */
    @keyframes fade-in-top {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fade-in-bottom {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Hide Ads Styles */
    :root img[width="728"][height="90"], 
    :root [href*="adstub.net"], 
    :root [href*="googlesyndication.com"],
    :root ins.adsbygoogle,
    :root div[id*="google_dfp_"],
    :root [data-ad-*] {
      display: none !important;
    }

    /* Changelogfy Styles */
    .changelogfy-launcher-wrapper .changelogfy-badge-container {
      margin-top: -4px;
      margin-right: -4px;
      top: 0;
      right: 0;
    }

    .changelogfy-badge-container {
      visibility: hidden;
    }

    .changelogfy-badge-container.show {
      visibility: visible;
      height: 22px;
      width: 22px;
      display: inline-flex;
      flex: 0 0 0%;
      cursor: pointer;
      padding: 0px;
      position: relative;
      vertical-align: middle;
    }

    .changelogfy-badge {
      position: absolute;
      color: #fff;
      font-size: 11px;
      width: 20px;
      height: 20px;
      border-radius: 100%;
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
      background: #ec4673;
    }

    .changelogfy-badge::before {
      content: "";
      width: 22px;
      height: 22px;
      border-radius: 100%;
      background-color: #ec4673;
      position: absolute;
      margin: auto;
      transform: scale(1);
      transform-origin: center center;
      -webkit-animation: changelogfy-badge-pulse 2s linear infinite;
      animation: changelogfy-badge-pulse 2s linear infinite;
    }

    @keyframes changelogfy-badge-pulse {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(1.4); opacity: 0; }
    }

    .changelogfy-badge-counter {
      color: #fff;
      z-index: 5;
    }

    .changelogfy-iframe-widget {
      display: none;
    }

    .changelogfy-iframe-widget.show {
      display: block;
      border: 0;
      z-index: 9999999;
      overflow: hidden;
      margin-top: auto;
      margin-bottom: auto;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      animation: changelogfy-fade-in 0.5s;
      max-height: 100%;
    }

    .changelogfy-launcher {
      height: 48px !important;
      width: 48px !important;
      border-radius: 100% !important;
      position: fixed !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      cursor: pointer !important;
      box-shadow: 0 2px 5px 0 rgb(0 0 0 / 26%) !important;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1) !important;
      z-index: 99999 !important;
      box-sizing: border-box !important;
    }

    @keyframes changelogfy-fade-in {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Background -->
  <canvas id="particle-network"></canvas>

  <!-- Blob Animations -->
  <div class="blob"></div>
  <div class="blob"></div>
  <div class="blob"></div>

  <!-- Firebase Status -->
  <div class="firebase-status" id="firebaseStatus" style="font-size: 10px; padding: 2px 8px; opacity: 0.6;">Local Mode</div>

  <!-- Proxy Browser Container -->
  <div class="proxy-container" id="proxyContainer">
    <div class="proxy-header">
      <button class="proxy-btn" onclick="goBack()" title="Back">
        <i class="fa-solid fa-arrow-left"></i>
      </button>
      <button class="proxy-btn" onclick="goForward()" title="Forward">
        <i class="fa-solid fa-arrow-right"></i>
      </button>
      <button class="proxy-btn" onclick="refreshPage()" title="Refresh">
        <i class="fa-solid fa-refresh"></i>
      </button>
      <input type="text" class="proxy-url-bar" id="urlBar" placeholder="Enter website URL..." onkeypress="handleUrlInput(event)">
      <button class="proxy-btn" onclick="loadUrl()" title="Go">
        <i class="fa-solid fa-arrow-right"></i>
      </button>
      <button class="proxy-btn" onclick="hideProxy()" title="Close">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>
    <iframe id="proxyFrame" class="proxy-iframe" src="about:blank"></iframe>
  </div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- Player Profile Modal -->
  <div class="modal-overlay" id="playerProfileModal">
    <div class="modal">
      <button class="close-modal" id="closePlayerModal">&times;</button>
      <div class="modal-header">
        <h2 class="modal-title" id="playerProfileName">Player Profile</h2>
        <p class="modal-subtitle" id="playerProfileLevel">Level 1</p>
      </div>
      <div id="playerProfileContent">
        <div class="profile-header">
          <div class="profile-avatar" id="playerProfileAvatar">
            <i class="fa-solid fa-user"></i>
          </div>
          <div class="xp-bar-container">
            <div class="xp-bar" id="playerXPBar" style="width: 0%"></div>
          </div>
          <div class="xp-text" id="playerXPText">0 / 100 XP</div>
        </div>
        <div>
          <h3 style="color: var(--viz-300); margin-bottom: 15px;">üìù Bio</h3>
          <p id="playerBio" style="color: var(--muted); font-style: italic;">No bio yet</p>
        </div>
        <div>
          <h3 style="color: var(--viz-300); margin-bottom: 15px;">üìä Stats</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div style="text-align: center; padding: 10px; background: rgba(255,255,255,.05); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: bold; color: var(--viz-300);" id="playerGamesPlayed">0</div>
              <div style="font-size: 12px; color: var(--muted);">Games Played</div>
            </div>
            <div style="text-align: center; padding: 10px; background: rgba(255,255,255,.05); border-radius: 8px;">
              <div style="font-size: 24px; font-weight: bold; color: var(--viz-300);" id="playerBadges">0</div>
              <div style="font-size: 12px; color: var(--muted);">Badges Earned</div>
            </div>
          </div>
        </div>
        <div>
          <h3 style="color: var(--viz-300); margin-bottom: 15px;">üèÜ Badges</h3>
          <div class="badges-grid" id="playerBadgesGrid">
            <!-- Badges will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>




  <!-- Login Modal -->
  <div class="modal-overlay" id="loginModal">
    <div class="modal">
      <button class="close-modal" id="closeModal">&times;</button>
      <div class="modal-header">
        <h2 class="modal-title">Welcome to VizualNetwork</h2>
        <p class="modal-subtitle">Sign in to track your progress and compete with others!</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label" for="loginUsername">Email</label>
          <input type="email" id="loginUsername" class="form-input" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="loginPassword">Password</label>
          <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="btn-primary">Sign In</button>
        <div class="form-switch">
          Don't have an account? <a href="#" id="showRegister">Create one</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Register Modal -->
  <div class="modal-overlay" id="registerModal">
    <div class="modal">
      <button class="close-modal" id="closeRegisterModal">&times;</button>
      <div class="modal-header">
        <h2 class="modal-title">Create Account</h2>
        <p class="modal-subtitle">Join the VizualNetwork community!</p>
      </div>
      <form id="registerForm">
        <div class="form-group">
          <label class="form-label" for="registerUsername">Username</label>
          <input type="text" id="registerUsername" class="form-input" placeholder="Choose a username" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="registerEmail">Email</label>
          <input type="email" id="registerEmail" class="form-input" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="registerPassword">Password</label>
          <input type="password" id="registerPassword" class="form-input" placeholder="Create a password" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="registerBio">Bio (Optional)</label>
          <input type="text" id="registerBio" class="form-input" placeholder="Tell us about yourself">
        </div>
        <button type="submit" class="btn-primary">Create Account</button>
        <div class="form-switch">
          Already have an account? <a href="#" id="showLogin">Sign in</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Dynamic Island Navigation -->
  <div class="nav-wrap">
    <div class="nav" id="nav">
      <div class="nav-header">
        <div class="nav-logo"><i class="fa-solid fa-globe"></i></div>
        <div class="nav-label">VizualNetwork</div>
      </div>
      <div class="nav-menu">
        <a href="#proxy" class="nav-tab">
          <i class="fa-solid fa-shield-alt" style="margin-right: 8px;"></i>
          Proxy
        </a>
        <a href="#tools" class="nav-tab">
          <i class="fa-solid fa-tools" style="margin-right: 8px;"></i>
          Tools
        </a>
        <a href="#security" class="nav-tab">
          <i class="fa-solid fa-lock" style="margin-right: 8px;"></i>
          Security
        </a>
        <a href="#profile" class="nav-tab" id="profileTab" style="display: none;">
          <i class="fa-solid fa-user" style="margin-right: 8px;"></i>
          Profile
        </a>
        <div class="nav-tab" onclick="showProxy()" style="background: linear-gradient(45deg, var(--primary), var(--secondary)); color: white;">
          <i class="fa-solid fa-globe" style="margin-right: 8px;"></i>
          Browse
        </div>
        <div class="nav-tab panic-btn" onclick="panicButton()" style="background: linear-gradient(45deg, #ff4757, #ff3838); color: white;">
          <i class="fa-solid fa-shield-halved" style="margin-right: 8px;"></i>
          Panic
        </div>
        <a href="#about" class="nav-tab">
          <i class="fa-solid fa-info-circle" style="margin-right: 8px;"></i>
          About
        </a>
        <div class="nav-tab" id="loginBtn" style="background: var(--viz); color: #fff;">
          <i class="fa-solid fa-sign-in-alt" style="margin-right: 8px;"></i>
          Login
        </div>
        <div class="nav-tab" id="userInfo" style="display: none; background: rgba(100,160,255,0.2);">
          <i class="fa-solid fa-user-circle" style="margin-right: 8px;"></i>
          <span id="usernameDisplay">User</span>
        </div>
      </div>
      <span class="nav-ripple"></span>
    </div>
  </div>

  <!-- Header -->
  <header>
    <h1 class="brand"><em>VIZUAL</em>NETWORK</h1>
    <div class="holo-earth">
      <div class="holo-globe"></div>
      <div class="holo-rim"></div>
    </div>
    <p class="tag">Secure, fast, and reliable web proxy service. Browse the internet with privacy and freedom.</p>
  </header>

  <!-- Main -->
  <main class="container">
    <section class="card" id="proxy">
      <h2>Web Proxy Service</h2>
      <p>Access any website securely and privately with our advanced proxy technology. <strong>No registration required, but create an account to track your browsing history and unlock premium features!</strong></p>
      <div class="proxy-features">
        <div class="feature-card">
          <div class="feature-icon"><i class="fa-solid fa-shield-alt"></i></div>
          <div class="feature-info">
            <h3 class="feature-title">Secure Browsing</h3>
            <p class="feature-desc">Advanced encryption and privacy protection for all your web activities.</p>
            <button class="feature-btn" onclick="showProxy()">Start Browsing</button>
          </div>
        </div>
        <div class="feature-card">
          <div class="feature-icon"><i class="fa-solid fa-rocket"></i></div>
          <div class="feature-info">
            <h3 class="feature-title">Lightning Fast</h3>
            <p class="feature-desc">Optimized servers for maximum speed and minimal latency.</p>
            <button class="feature-btn" onclick="showProxy()">Try Now</button>
          </div>
        </div>
        <div class="feature-card">
          <div class="feature-icon"><i class="fa-solid fa-eye-slash"></i></div>
          <div class="feature-info">
            <h3 class="feature-title">Complete Privacy</h3>
            <p class="feature-desc">Your browsing activity remains completely anonymous and untracked.</p>
            <button class="feature-btn" onclick="showProxy()">Browse Privately</button>
          </div>
        </div>
      </div>
    </section>

    <section class="card" id="tools">
      <h2>Web Tools & Utilities</h2>
      <p>Access a comprehensive suite of web-based tools and utilities. From calculators to text processors, all accessible through our secure proxy network.</p>
      <div class="tools-grid">
        <div class="tool-card">
          <div class="tool-icon"><i class="fa-solid fa-calculator"></i></div>
          <div class="tool-info">
            <h3 class="tool-title">Advanced Calculator</h3>
            <p class="tool-desc">Scientific calculator with advanced mathematical functions and graphing capabilities.</p>
            <button class="tool-btn" onclick="showProxy()">Access Calculator</button>
          </div>
        </div>
        <div class="tool-card">
          <div class="tool-icon"><i class="fa-solid fa-file-alt"></i></div>
          <div class="tool-info">
            <h3 class="tool-title">Text Editor</h3>
            <p class="tool-desc">Online text editor with syntax highlighting and collaboration features.</p>
            <button class="tool-btn" onclick="showProxy()">Open Editor</button>
          </div>
        </div>
      </div>
    </section>

    <section class="card" id="security">
      <h2>Privacy & Security Center</h2>
      <p>Learn about online privacy, security best practices, and how to protect your digital footprint. Access educational resources and security tools.</p>
      <div class="security-grid">
        <div class="security-card">
          <div class="security-icon"><i class="fa-solid fa-shield-virus"></i></div>
          <div class="security-info">
            <h3 class="security-title">Security Scanner</h3>
            <p class="security-desc">Scan websites for security vulnerabilities and malware threats.</p>
            <button class="security-btn" onclick="showProxy()">Scan Website</button>
          </div>
        </div>
        <div class="security-card">
          <div class="security-icon"><i class="fa-solid fa-key"></i></div>
          <div class="security-info">
            <h3 class="security-title">Password Generator</h3>
            <p class="security-desc">Generate secure, random passwords for your online accounts.</p>
            <button class="security-btn" onclick="showProxy()">Generate Password</button>
          </div>
        </div>
      </div>
    </section>

    <section class="card" id="profile">
      <h2>Your Profile</h2>
      <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">
          <i class="fa-solid fa-user"></i>
        </div>
        <h3 class="profile-username" id="profileUsername">Guest User</h3>
        <p class="profile-level" id="profileLevel">Level 1</p>
        <div class="xp-bar-container">
          <div class="xp-bar" id="xpBar" style="width: 0%"></div>
        </div>
        <div class="xp-text" id="xpText">0 / 100 XP</div>
        <button onclick="userSystem.shareProgress()" style="margin-top: 15px; padding: 10px 20px; background: var(--viz-300); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
          <i class="fa-solid fa-share" style="margin-right: 8px;"></i>
          Share Progress
        </button>
      </div>
      <div>
        <h3 style="color: var(--viz-300); margin-bottom: 15px;">üèÜ Achievements</h3>
        <div class="badges-grid" id="badgesGrid">
          <div class="badge" data-badge="first-browse">
            <div class="badge-icon"><i class="fa-solid fa-globe"></i></div>
            <p class="badge-name">First Browse</p>
          </div>
          <div class="badge" data-badge="level-5">
            <div class="badge-icon"><i class="fa-solid fa-star"></i></div>
            <p class="badge-name">Level 5</p>
          </div>
          <div class="badge" data-badge="security-expert">
            <div class="badge-icon"><i class="fa-solid fa-shield-alt"></i></div>
            <p class="badge-name">Security Expert</p>
          </div>
          <div class="badge" data-badge="privacy-champion">
            <div class="badge-icon"><i class="fa-solid fa-eye-slash"></i></div>
            <p class="badge-name">Privacy Champion</p>
          </div>
          <div class="badge" data-badge="streak-7">
            <div class="badge-icon"><i class="fa-solid fa-fire"></i></div>
            <p class="badge-name">7 Day Streak</p>
          </div>
          <div class="badge" data-badge="top-10">
            <div class="badge-icon"><i class="fa-solid fa-trophy"></i></div>
            <p class="badge-name">Top 10</p>
          </div>
        </div>
      </div>
    </section>


    <section class="card" id="tools">
      <h2>Study Tools & Utilities</h2>
      <p>Helpful tools for studying and productivity. All tools work offline and are school-friendly!</p>
      <div class="games-grid">
        <div class="coming-soon">
          <i class="fa-solid fa-tools"></i>
          <h3>Study Tools Coming Soon</h3>
          <p>Helpful study tools and utilities will be available here soon!</p>
        </div>
      </div>
    </section>


    <section class="card" id="about">
      <h2>About VizualNetwork</h2>
      <p>VizualNetwork is a next-generation web proxy platform designed to provide secure, fast, and reliable internet access. Our advanced proxy technology ensures your browsing experience is both private and unrestricted, perfect for school, work, or personal use.</p>
      <div style="margin-top: 20px; padding: 20px; background: rgba(100,160,255,0.1); border-radius: 12px; border-left: 4px solid var(--viz-300);">
        <h3 style="margin: 0 0 10px; color: var(--viz-300);">‚ú® Features</h3>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted);">
          <li>Advanced encryption and privacy protection</li>
          <li>Lightning-fast browsing with optimized servers</li>
          <li>Works on all devices - desktop, tablet, and mobile</li>
          <li>No downloads required - access instantly in your browser</li>
          <li>Complete anonymity and IP masking</li>
          <li>User accounts with activity tracking and achievements</li>
          <li>Built-in security tools and privacy utilities</li>
          <li>Regular updates with enhanced security features</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <p>¬© 2024 VizualNetwork. All rights reserved.</p>
    <p>Secure web proxy service - Privacy and freedom for all users.</p>
  </footer>

  <!-- Scripts -->
  <script>
    // ===== ENHANCED LOCALSTORAGE SYSTEM FOR GOOGLE SLIDES =====
    class EnhancedUserSystem {
      constructor() {
        this.currentUser = null;
        this.userData = null;
        this.users = [];
        this.sharedLeaderboard = [];
        this.init();
      }

      init() {
        this.setupEventListeners();
        this.loadUsers();
        this.loadSharedLeaderboard();
        this.checkLoginStatus();
        this.updateUI();
        this.updateStatus('Enhanced LocalStorage Mode - Google Slides Compatible', 'connected');
        this.startLeaderboardSync();
      }

      startLeaderboardSync() {
        // Simulate real-time updates by checking for shared data
        setInterval(() => {
          this.loadSharedLeaderboard();
        }, 5000); // Check every 5 seconds
      }

      loadUsers() {
        const stored = localStorage.getItem('vizualNetworkUsers');
        this.users = stored ? JSON.parse(stored) : [];
        return this.users;
      }

      loadSharedLeaderboard() {
        // Load shared leaderboard data from localStorage
        const shared = localStorage.getItem('vizualNetworkSharedLeaderboard');
        this.sharedLeaderboard = shared ? JSON.parse(shared) : [];
      }

      saveUsers() {
        localStorage.setItem('vizualNetworkUsers', JSON.stringify(this.users));
        this.shareToLeaderboard();
      }

      shareToLeaderboard() {
        if (!this.userData) return;
        
        // Add current user to shared leaderboard
        const existingIndex = this.sharedLeaderboard.findIndex(u => u.id === this.userData.id);
        const leaderboardEntry = {
          id: this.userData.id,
          username: this.userData.username,
          xp: this.userData.xp,
          level: this.userData.level,
          lastUpdate: Date.now()
        };

        if (existingIndex >= 0) {
          this.sharedLeaderboard[existingIndex] = leaderboardEntry;
        } else {
          this.sharedLeaderboard.push(leaderboardEntry);
        }

        // Sort by XP and keep top 50
        this.sharedLeaderboard.sort((a, b) => b.xp - a.xp);
        this.sharedLeaderboard = this.sharedLeaderboard.slice(0, 50);

        // Save to localStorage
        localStorage.setItem('vizualNetworkSharedLeaderboard', JSON.stringify(this.sharedLeaderboard));
      }

      generateUserId() {
        return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }

      register(username, email, password, bio = '') {
        // Check if username already exists
        if (this.users.find(u => u.username === username)) {
          throw new Error('Username already exists');
        }

        const user = {
          id: this.generateUserId(),
          username,
          email,
          password, // In real app, hash this!
          bio,
          xp: 0,
          level: 1,
          badges: [],
          gamesPlayed: 0,
          mathGamesPlayed: 0,
          biologyGamesPlayed: 0,
          lastLogin: new Date().toISOString(),
          joinDate: new Date().toISOString()
        };

        this.users.push(user);
        this.saveUsers();
        return user;
      }

      login(username, password) {
        const user = this.users.find(u => u.username === username && u.password === password);
        if (!user) {
          throw new Error('Invalid username or password');
        }

        user.lastLogin = new Date().toISOString();
        this.currentUser = user;
        this.userData = user;
        this.saveUsers();
        this.updateUI();
        return user;
      }

      logout() {
        this.currentUser = null;
        this.userData = null;
        this.updateUI();
      }

      async loadUserData() {
        if (!this.currentUser || !window.firebase) return;

        try {
          const userDoc = await window.firebase.getDoc(window.firebase.doc(window.firebase.collection(window.firebase.db, 'users'), this.currentUser.uid));
          
          if (userDoc.exists()) {
            this.userData = userDoc.data();
            this.updateUserDisplay();
          } else {
            // Create new user document
            await this.createUserDocument();
          }
        } catch (error) {
          console.error('Error loading user data:', error);
          this.updateFirebaseStatus('Error loading data', 'error');
        }
      }

      async createUserDocument() {
        if (!this.currentUser || !window.firebase) return;

        const userData = {
          username: this.currentUser.displayName || this.currentUser.email.split('@')[0],
          email: this.currentUser.email,
          bio: '',
          xp: 0,
          level: 1,
          badges: [],
          gamesPlayed: 0,
          mathGamesPlayed: 0,
          biologyGamesPlayed: 0,
          joinDate: window.firebase.serverTimestamp(),
          lastLogin: window.firebase.serverTimestamp()
        };

        try {
          await window.firebase.setDoc(
            window.firebase.doc(window.firebase.collection(window.firebase.db, 'users'), this.currentUser.uid),
            userData
          );
          this.userData = userData;
          this.updateUserDisplay();
        } catch (error) {
          console.error('Error creating user document:', error);
        }
      }

      async register(email, password, username, bio = '') {
        if (!window.firebase) {
          throw new Error('Firebase not available');
        }

        try {
          const userCredential = await window.firebase.createUserWithEmailAndPassword(window.firebase.auth, email, password);
          this.currentUser = userCredential.user;
          
          // Update display name
          await this.currentUser.updateProfile({
            displayName: username
          });

          // Create user document
          await this.createUserDocument();
          
          this.updateFirebaseStatus('Account created successfully!', 'connected');
          return userCredential.user;
        } catch (error) {
          throw new Error(error.message);
        }
      }

      async login(email, password) {
        if (!window.firebase) {
          throw new Error('Firebase not available');
        }

        try {
          const userCredential = await window.firebase.signInWithEmailAndPassword(window.firebase.auth, email, password);
          this.currentUser = userCredential.user;
          this.updateFirebaseStatus('Signed in successfully!', 'connected');
          return userCredential.user;
        } catch (error) {
          throw new Error(error.message);
        }
      }

      async logout() {
        if (window.firebase) {
          await window.firebase.signOut(window.firebase.auth);
        } else {
          this.currentUser = null;
          this.userData = null;
          this.updateUI();
        }
      }

      addXP(amount, source = 'game') {
        if (!this.userData) return;

        this.userData.xp += amount;
        
        // Check for level up
        const newLevel = this.calculateLevel(this.userData.xp);
        if (newLevel > this.userData.level) {
          this.userData.level = newLevel;
          this.showLevelUpNotification(newLevel);
        }

        // Check for badges
        this.checkBadges();
        this.updateUserDisplay();
        this.saveUsers(); // This will also share to leaderboard
      }

      calculateLevel(xp) {
        return Math.floor(xp / 100) + 1;
      }

      getXPForLevel(level) {
        return (level - 1) * 100;
      }

      getXPProgress() {
        if (!this.userData) return { current: 0, needed: 100, percentage: 0 };
        
        const currentLevelXP = this.getXPForLevel(this.userData.level);
        const nextLevelXP = this.getXPForLevel(this.userData.level + 1);
        const currentXP = this.userData.xp - currentLevelXP;
        const neededXP = nextLevelXP - currentLevelXP;
        const percentage = (currentXP / neededXP) * 100;

        return { current: currentXP, needed: neededXP, percentage: Math.min(percentage, 100) };
      }

      setupFirestoreListeners() {
        if (!window.firebase) return;

        // Real-time leaderboard updates
        const leaderboardQuery = window.firebase.query(
          window.firebase.collection(window.firebase.db, 'users'),
          window.firebase.orderBy('xp', 'desc'),
          window.firebase.limit(10)
        );

      }


      updateUserDisplay() {
        if (!this.userData) return;

        const usernameEl = document.getElementById('profileUsername');
        const levelEl = document.getElementById('profileLevel');
        const xpBarEl = document.getElementById('xpBar');
        const xpTextEl = document.getElementById('xpText');

        if (usernameEl) usernameEl.textContent = this.userData.username;
        if (levelEl) levelEl.textContent = `Level ${this.userData.level}`;
        
        const xpProgress = this.getXPProgress();
        if (xpBarEl) xpBarEl.style.width = `${xpProgress.percentage}%`;
        if (xpTextEl) xpTextEl.textContent = `${xpProgress.current} / ${xpProgress.needed} XP`;

        // Update badges
        document.querySelectorAll('.badge').forEach(badge => {
          const badgeId = badge.dataset.badge;
          if (this.userData.badges.includes(badgeId)) {
            badge.classList.add('earned');
          } else {
            badge.classList.remove('earned');
          }
        });
      }

      updateStatus(message, type = 'info') {
        const status = document.getElementById('firebaseStatus');
        if (status) {
          status.textContent = message;
          status.className = `firebase-status ${type}`;
        }
      }

      // Add sharing functionality
      shareProgress() {
        if (!this.userData) {
          this.showNotification('Please login to share your progress!', 'error');
          return;
        }

        const shareData = {
          username: this.userData.username,
          level: this.userData.level,
          xp: this.userData.xp,
          badges: this.userData.badges.length,
          message: `Check out my VizualNetwork progress! Level ${this.userData.level} with ${this.userData.xp} XP!`
        };

        // Create shareable text
        const shareText = `üéÆ VizualNetwork Progress üéÆ\n` +
          `üë§ Username: ${shareData.username}\n` +
          `‚≠ê Level: ${shareData.level}\n` +
          `üíé XP: ${shareData.xp}\n` +
          `üèÜ Badges: ${shareData.badges}\n\n` +
          `Play at: [Your Google Slides URL]`;

        // Copy to clipboard
        if (navigator.clipboard) {
          navigator.clipboard.writeText(shareText).then(() => {
            this.showNotification('Progress copied to clipboard! Share it with friends!', 'success');
          });
        } else {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = shareText;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          this.showNotification('Progress copied to clipboard! Share it with friends!', 'success');
        }
      }

      // Show player profile modal
      showPlayerProfile(userId) {
        // Find the user in local users or shared leaderboard
        let player = this.users.find(u => u.id === userId);
        if (!player) {
          player = this.sharedLeaderboard.find(u => u.id === userId);
        }

        if (!player) {
          this.showNotification('Player not found', 'error');
          return;
        }

        // Populate the modal
        document.getElementById('playerProfileName').textContent = player.username;
        document.getElementById('playerProfileLevel').textContent = `Level ${player.level}`;
        document.getElementById('playerBio').textContent = player.bio || 'No bio yet';
        document.getElementById('playerGamesPlayed').textContent = player.gamesPlayed || 0;
        document.getElementById('playerBadges').textContent = player.badges ? player.badges.length : 0;

        // Calculate XP progress
        const currentLevelXP = this.getXPForLevel(player.level);
        const nextLevelXP = this.getXPForLevel(player.level + 1);
        const currentXP = player.xp - currentLevelXP;
        const neededXP = nextLevelXP - currentLevelXP;
        const percentage = (currentXP / neededXP) * 100;

        document.getElementById('playerXPBar').style.width = `${Math.min(percentage, 100)}%`;
        document.getElementById('playerXPText').textContent = `${currentXP} / ${neededXP} XP`;

        // Show badges
        this.updatePlayerBadges(player.badges || []);

        // Show the modal
        document.getElementById('playerProfileModal').classList.add('active');
      }

      updatePlayerBadges(badges) {
        const badgesGrid = document.getElementById('playerBadgesGrid');
        const allBadges = [
          { id: 'first-game', name: 'First Game', icon: 'fa-play' },
          { id: 'level-5', name: 'Level 5', icon: 'fa-star' },
          { id: 'math-master', name: 'Math Master', icon: 'fa-calculator' },
          { id: 'biology-expert', name: 'Biology Expert', icon: 'fa-dna' },
          { id: 'streak-7', name: '7 Day Streak', icon: 'fa-fire' },
          { id: 'top-10', name: 'Top 10', icon: 'fa-trophy' }
        ];

        badgesGrid.innerHTML = allBadges.map(badge => {
          const earned = badges.includes(badge.id);
          return `
            <div class="badge ${earned ? 'earned' : ''}">
              <div class="badge-icon"><i class="fa-solid ${badge.icon}"></i></div>
              <p class="badge-name">${badge.name}</p>
            </div>
          `;
        }).join('');
      }

      checkBadges() {
        if (!this.currentUser) return;

        const badges = [
          { id: 'first-game', condition: () => this.currentUser.gamesPlayed >= 1 },
          { id: 'level-5', condition: () => this.currentUser.level >= 5 },
          { id: 'math-master', condition: () => this.currentUser.mathGamesPlayed >= 10 },
          { id: 'biology-expert', condition: () => this.currentUser.biologyGamesPlayed >= 10 },
          { id: 'streak-7', condition: () => this.getStreakDays() >= 7 },
          { id: 'top-10', condition: () => this.getUserRank() <= 10 }
        ];

        badges.forEach(badge => {
          if (!this.currentUser.badges.includes(badge.id) && badge.condition()) {
            this.currentUser.badges.push(badge.id);
            this.showBadgeNotification(badge.id);
          }
        });
      }

      getStreakDays() {
        // Simplified - in real app, track daily logins
        return Math.floor(this.currentUser.xp / 50);
      }

      getUserRank() {
        const sortedUsers = [...this.users].sort((a, b) => b.xp - a.xp);
        return sortedUsers.findIndex(u => u.id === this.currentUser.id) + 1;
      }

      showLevelUpNotification(level) {
        // Create notification
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed; top: 20px; right: 20px; z-index: 1001;
          background: linear-gradient(135deg, var(--viz), var(--viz-300));
          color: white; padding: 15px 20px; border-radius: 12px;
          box-shadow: 0 8px 25px rgba(100,160,255,.4);
          font-weight: 600; animation: slideIn 0.5s ease;
        `;
        notification.innerHTML = `üéâ Level Up! You're now level ${level}!`;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'slideOut 0.5s ease';
          setTimeout(() => notification.remove(), 500);
        }, 3000);
      }

      showBadgeNotification(badgeId) {
        const badgeNames = {
          'first-game': 'First Game',
          'level-5': 'Level 5',
          'math-master': 'Math Master',
          'biology-expert': 'Biology Expert',
          'streak-7': '7 Day Streak',
          'top-10': 'Top 10'
        };

        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed; top: 20px; right: 20px; z-index: 1001;
          background: linear-gradient(135deg, #ffd700, #ffed4e);
          color: #333; padding: 15px 20px; border-radius: 12px;
          box-shadow: 0 8px 25px rgba(255,215,0,.4);
          font-weight: 600; animation: slideIn 0.5s ease;
        `;
        notification.innerHTML = `üèÜ Badge Earned: ${badgeNames[badgeId]}!`;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'slideOut 0.5s ease';
          setTimeout(() => notification.remove(), 500);
        }, 3000);
      }

      updateUI() {
        const loginBtn = document.getElementById('loginBtn');
        const userInfo = document.getElementById('userInfo');
        const usernameDisplay = document.getElementById('usernameDisplay');
        const profileTab = document.getElementById('profileTab');
        if (this.currentUser) {
          loginBtn.style.display = 'none';
          userInfo.style.display = 'flex';
          usernameDisplay.textContent = this.currentUser.username;
          profileTab.style.display = 'flex';
          this.updateProfile();
        } else {
          loginBtn.style.display = 'flex';
          userInfo.style.display = 'none';
          profileTab.style.display = 'none';
        }
      }

      updateProfile() {
        if (!this.currentUser) return;

        document.getElementById('profileUsername').textContent = this.currentUser.username;
        document.getElementById('profileLevel').textContent = `Level ${this.currentUser.level}`;
        
        const xpProgress = this.getXPProgress();
        document.getElementById('xpBar').style.width = `${xpProgress.percentage}%`;
        document.getElementById('xpText').textContent = `${xpProgress.current} / ${xpProgress.needed} XP`;

        // Update badges
        document.querySelectorAll('.badge').forEach(badge => {
          const badgeId = badge.dataset.badge;
          if (this.currentUser.badges.includes(badgeId)) {
            badge.classList.add('earned');
          } else {
            badge.classList.remove('earned');
          }
        });
      }


      setupEventListeners() {
        // Login modal
        document.getElementById('loginBtn').addEventListener('click', () => {
          document.getElementById('loginModal').classList.add('active');
        });

        document.getElementById('closeModal').addEventListener('click', () => {
          document.getElementById('loginModal').classList.remove('active');
        });

        document.getElementById('showRegister').addEventListener('click', (e) => {
          e.preventDefault();
          document.getElementById('loginModal').classList.remove('active');
          document.getElementById('registerModal').classList.add('active');
        });

        // Register modal
        document.getElementById('closeRegisterModal').addEventListener('click', () => {
          document.getElementById('registerModal').classList.remove('active');
        });

        document.getElementById('showLogin').addEventListener('click', (e) => {
          e.preventDefault();
          document.getElementById('registerModal').classList.remove('active');
          document.getElementById('loginModal').classList.add('active');
        });

        // Forms
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('loginUsername').value; // Using email for Firebase
          const password = document.getElementById('loginPassword').value;
          
          try {
            await this.login(email, password);
            document.getElementById('loginModal').classList.remove('active');
            this.showNotification('Welcome back!', 'success');
          } catch (error) {
            this.showNotification(error.message, 'error');
          }
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const username = document.getElementById('registerUsername').value;
          const email = document.getElementById('registerEmail').value;
          const password = document.getElementById('registerPassword').value;
          const bio = document.getElementById('registerBio').value;
          
          try {
            await this.register(email, password, username, bio);
            document.getElementById('registerModal').classList.remove('active');
            this.showNotification('Account created successfully!', 'success');
          } catch (error) {
            this.showNotification(error.message, 'error');
          }
        });

        // Logout
        document.getElementById('userInfo').addEventListener('click', () => {
          this.logout();
          this.showNotification('Logged out successfully', 'info');
        });

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
          overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
              overlay.classList.remove('active');
            }
          });
        });

        // Player profile modal
        document.getElementById('closePlayerModal').addEventListener('click', () => {
          document.getElementById('playerProfileModal').classList.remove('active');
        });
      }

      checkLoginStatus() {
        const savedUserId = localStorage.getItem('currentUserId');
        if (savedUserId) {
          const user = this.users.find(u => u.id === savedUserId);
          if (user) {
            this.currentUser = user;
          }
        }
      }

      showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        const colors = {
          success: 'linear-gradient(135deg, #10b981, #34d399)',
          error: 'linear-gradient(135deg, #ef4444, #f87171)',
          info: 'linear-gradient(135deg, var(--viz), var(--viz-300))'
        };
        
        notification.style.cssText = `
          position: fixed; top: 20px; right: 20px; z-index: 1001;
          background: ${colors[type]}; color: white; padding: 15px 20px;
          border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,.2);
          font-weight: 600; animation: slideIn 0.5s ease;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'slideOut 0.5s ease';
          setTimeout(() => notification.remove(), 500);
        }, 3000);
      }
    }

    // Initialize Enhanced user system for Google Slides
    const userSystem = new EnhancedUserSystem();

    // Enhanced Dynamic Island Navigation
    const nav = document.getElementById('nav');
    const navTabs = document.querySelectorAll('.nav-tab');
    let isOpen = false;

    // Create ripple element if it doesn't exist
    let ripple = nav.querySelector('.nav-ripple');
    if (!ripple) {
      ripple = document.createElement('span');
      ripple.className = 'nav-ripple';
      nav.appendChild(ripple);
    }

    // Toggle navigation with enhanced animations
    nav.addEventListener('click', (e) => {
      e.preventDefault();
      isOpen = !isOpen;
      nav.classList.toggle('open', isOpen);
      
      // Create ripple effect
      const rect = nav.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = `${e.clientX - rect.left - size / 2}px`;
      ripple.style.top = `${e.clientY - rect.top - size / 2}px`;
      
      // Trigger ripple animation
      ripple.style.animation = 'none';
      ripple.offsetHeight; // Force reflow
      ripple.style.animation = 'ripple 0.6s linear';
    });

    // Smooth scrolling for navigation tabs
    navTabs.forEach(tab => {
      tab.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = tab.getAttribute('href');
        
        if (targetId.startsWith('#')) {
          const targetElement = document.querySelector(targetId);
          if (targetElement) {
            // Close navigation on mobile after clicking
            if (window.innerWidth <= 768) {
              nav.classList.remove('open');
              isOpen = false;
            }
            
            // Smooth scroll to target
            targetElement.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
            
            // Update active tab
            updateActiveTab(tab);
          }
        }
      });
    });

    // Update active tab based on scroll position
    function updateActiveTab(activeTab) {
      navTabs.forEach(tab => {
        tab.classList.remove('active');
      });
      if (activeTab) {
        activeTab.classList.add('active');
      }
    }

    // Scroll spy - highlight active section
    function handleScrollSpy() {
      const sections = document.querySelectorAll('section[id]');
      const scrollPos = window.scrollY + 100;

      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.offsetHeight;
        const sectionId = section.getAttribute('id');

        if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
          const correspondingTab = document.querySelector(`.nav-tab[href="#${sectionId}"]`);
          updateActiveTab(correspondingTab);
        }
      });
    }

    // Throttled scroll handler
    let scrollTimeout;
    window.addEventListener('scroll', () => {
      if (scrollTimeout) {
        clearTimeout(scrollTimeout);
      }
      scrollTimeout = setTimeout(handleScrollSpy, 10);
    });

    // Close navigation when clicking outside
    document.addEventListener('click', (e) => {
      if (isOpen && !nav.contains(e.target)) {
        nav.classList.remove('open');
        isOpen = false;
      }
    });

    // Handle escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) {
        nav.classList.remove('open');
        isOpen = false;
      }
    });

    // Initialize active tab on page load
    handleScrollSpy();

    // ===== FEATURE INTERACTION SYSTEM =====
    class FeatureSystem {
      constructor() {
        this.setupFeatureInteractions();
      }

      setupFeatureInteractions() {
        // Add XP when clicking feature buttons
        document.addEventListener('click', (e) => {
          if (e.target.classList.contains('feature-btn') || 
              e.target.classList.contains('tool-btn') || 
              e.target.classList.contains('security-btn')) {
            this.handleFeatureClick(e.target);
          }
        });

        // Add XP for navigation interactions
        document.addEventListener('click', (e) => {
          if (e.target.closest('.nav-tab')) {
            this.handleNavigationClick(e.target.closest('.nav-tab'));
          }
        });
      }

      handleFeatureClick(button) {
        if (!userSystem.currentUser) {
          userSystem.showNotification('Please login to track your activity!', 'info');
          return;
        }

        const card = button.closest('.feature-card, .tool-card, .security-card');
        const title = card.querySelector('.feature-title, .tool-title, .security-title').textContent;
        
        // Add XP for using features
        userSystem.addXP(5, 'feature');
        userSystem.showNotification(`+5 XP for using ${title}!`, 'success');
      }

      handleNavigationClick(tab) {
        if (!userSystem.currentUser) return;

        // Add small XP for exploring different sections
        const href = tab.getAttribute('href');
        if (href && href.startsWith('#')) {
          userSystem.addXP(2, 'navigation');
        }
      }
    }

    // Initialize feature system
    const featureSystem = new FeatureSystem();

    // Demo function to add sample users and XP
    function addDemoData() {
      if (userSystem.users.length === 0) {
        // Add some demo users
        const demoUsers = [
          { username: 'GameMaster', email: 'gamer@demo.com', password: 'demo123', bio: 'Professional gamer' },
          { username: 'MathWiz', email: 'math@demo.com', password: 'demo123', bio: 'Math enthusiast' },
          { username: 'BioExpert', email: 'bio@demo.com', password: 'demo123', bio: 'Biology student' },
          { username: 'NewPlayer', email: 'new@demo.com', password: 'demo123', bio: 'Just getting started' }
        ];

        demoUsers.forEach((userData, index) => {
          try {
            const user = userSystem.register(userData.username, userData.email, userData.password, userData.bio);
            // Add some demo XP
            user.xp = (index + 1) * 150;
            user.level = userSystem.calculateLevel(user.xp);
            user.gamesPlayed = (index + 1) * 5;
            user.mathGamesPlayed = (index + 1) * 3;
            user.biologyGamesPlayed = (index + 1) * 2;
            
            // Add some badges
            if (user.gamesPlayed >= 1) user.badges.push('first-game');
            if (user.level >= 5) user.badges.push('level-5');
            if (user.mathGamesPlayed >= 10) user.badges.push('math-master');
            if (user.biologyGamesPlayed >= 10) user.badges.push('biology-expert');
          } catch (e) {
            console.log('Demo user already exists:', userData.username);
          }
        });

        userSystem.saveUsers();
      }
    }

    // Add demo data on page load
    addDemoData();

    // ===== GAME SYSTEM =====
    let currentGame = null;
    let gameRunning = false;
    let gamePaused = false;
    let gameScore = 0;
    let gameLoop = null;

    // Game configurations
    const gameConfigs = {
      html5: {
        title: 'Truck Space 2',
        instructions: 'Navigate your space truck through missions and challenges. Use arrow keys or WASD to control your vehicle.',
        xpReward: 30
      },
      snake: {
        title: 'Snake Game',
        instructions: 'Use arrow keys to control the snake. Eat food to grow!',
        xpReward: 15
      },
      tetris: {
        title: 'Tetris',
        instructions: 'Use arrow keys to move and rotate pieces. Press space to drop!',
        xpReward: 20
      },
      aim: {
        title: 'Aim Trainer',
        instructions: 'Click on the targets as fast as you can!',
        xpReward: 10
      },
      memory: {
        title: 'Memory Match',
        instructions: 'Click cards to find matching pairs!',
        xpReward: 12
      },
      typing: {
        title: 'Typing Test',
        instructions: 'Type the words as fast as you can!',
        xpReward: 8
      },
      chess: {
        title: 'Chess',
        instructions: 'Click to move pieces. Play against the computer!',
        xpReward: 25
      },
      '2048': {
        title: '2048',
        instructions: 'Use arrow keys to slide tiles. Combine numbers to reach 2048!',
        xpReward: 18
      },
      space: {
        title: 'Space Invaders',
        instructions: 'Use arrow keys to move and space to shoot!',
        xpReward: 22
      },
      racing: {
        title: 'Racing Game',
        instructions: 'Use arrow keys to avoid obstacles and collect coins!',
        xpReward: 16
      },
      basketball: {
        title: 'Basketball',
        instructions: 'Click and drag to aim and shoot the ball!',
        xpReward: 14
      },
      subway: {
        title: 'Subway Surfers',
        instructions: 'Use arrow keys to run and jump. Avoid obstacles!',
        xpReward: 20
      },
      soccer: {
        title: 'Soccer Physics',
        instructions: 'Click and drag to kick the ball into the goal!',
        xpReward: 16
      },
      tower: {
        title: 'Tower Defense',
        instructions: 'Click to place towers and defend your base!',
        xpReward: 25
      },
      rope: {
        title: 'Cut the Rope',
        instructions: 'Click to cut ropes and feed the candy to the monster!',
        xpReward: 18
      },
      flappy: {
        title: 'Flappy Bird',
        instructions: 'Click or press space to flap and avoid pipes!',
        xpReward: 12
      },
      pacman: {
        title: 'Pac-Man',
        instructions: 'Use arrow keys to eat dots and avoid ghosts!',
        xpReward: 22
      },
      angry: {
        title: 'Angry Birds',
        instructions: 'Click and drag to aim, release to launch birds!',
        xpReward: 19
      },
      temple: {
        title: 'Temple Run',
        instructions: 'Use arrow keys to run, jump, and slide through the temple!',
        xpReward: 24
      },
      fruit: {
        title: 'Fruit Ninja',
        instructions: 'Click and drag to slice fruits. Avoid bombs!',
        xpReward: 16
      }
    };


    function initGame(gameType) {
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');
      
      // Clear canvas
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      switch(gameType) {
        case 'html5':
          initHTML5Game(ctx, canvas);
          break;
        case 'snake':
          initSnakeGame(ctx, canvas);
          break;
        case 'tetris':
          initTetrisGame(ctx, canvas);
          break;
        case 'aim':
          initAimGame(ctx, canvas);
          break;
        case 'memory':
          initMemoryGame(ctx, canvas);
          break;
        case 'typing':
          initTypingGame(ctx, canvas);
          break;
        case '2048':
          init2048Game(ctx, canvas);
          break;
        case 'space':
          initSpaceGame(ctx, canvas);
          break;
        case 'racing':
          initRacingGame(ctx, canvas);
          break;
        case 'basketball':
          initBasketballGame(ctx, canvas);
          break;
        case 'chess':
          initChessGame(ctx, canvas);
          break;
        case 'subway':
          initSubwayGame(ctx, canvas);
          break;
        case 'soccer':
          initSoccerGame(ctx, canvas);
          break;
        case 'tower':
          initTowerGame(ctx, canvas);
          break;
        case 'rope':
          initRopeGame(ctx, canvas);
          break;
        case 'flappy':
          initFlappyGame(ctx, canvas);
          break;
        case 'pacman':
          initPacmanGame(ctx, canvas);
          break;
        case 'angry':
          initAngryGame(ctx, canvas);
          break;
        case 'temple':
          initTempleGame(ctx, canvas);
          break;
        case 'fruit':
          initFruitGame(ctx, canvas);
          break;
      }
    }

    // Snake Game Implementation
    function initSnakeGame(ctx, canvas) {
      let snake = [{x: 300, y: 200}];
      let direction = {x: 0, y: 0};
      let food = {x: 100, y: 100};
      let gameSpeed = 150;

      function drawSnake() {
        ctx.fillStyle = '#0f0';
        snake.forEach(segment => {
          ctx.fillRect(segment.x, segment.y, 20, 20);
        });
      }

      function drawFood() {
        ctx.fillStyle = '#f00';
        ctx.fillRect(food.x, food.y, 20, 20);
      }

      function moveSnake() {
        if (direction.x === 0 && direction.y === 0) return;

        const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
        
        // Check wall collision
        if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
          endGame();
          return;
        }

        // Check self collision
        if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
          endGame();
          return;
        }

        snake.unshift(head);

        // Check food collision
        if (head.x === food.x && head.y === food.y) {
          gameScore += 10;
          updateScore();
          generateFood();
        } else {
          snake.pop();
        }
      }

      function generateFood() {
        food.x = Math.floor(Math.random() * (canvas.width / 20)) * 20;
        food.y = Math.floor(Math.random() * (canvas.height / 20)) * 20;
      }

      function updateScore() {
        document.getElementById('gameScore').textContent = `Score: ${gameScore}`;
      }

      function gameUpdate() {
        if (!gameRunning || gamePaused) return;

        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        moveSnake();
        drawSnake();
        drawFood();
      }

      function endGame() {
        gameRunning = false;
        if (userSystem.userData) {
          userSystem.addXP(gameConfigs.snake.xpReward, 'game');
          userSystem.showNotification(`Game Over! Final Score: ${gameScore}. +${gameConfigs.snake.xpReward} XP!`, 'success');
        } else {
          userSystem.showNotification(`Game Over! Final Score: ${gameScore}. Login to earn XP!`, 'info');
        }
      }

      // Event listeners
      document.addEventListener('keydown', (e) => {
        if (!gameRunning) return;
        switch(e.key) {
          case 'ArrowUp':
            if (direction.y === 0) direction = {x: 0, y: -20};
            break;
          case 'ArrowDown':
            if (direction.y === 0) direction = {x: 0, y: 20};
            break;
          case 'ArrowLeft':
            if (direction.x === 0) direction = {x: -20, y: 0};
            break;
          case 'ArrowRight':
            if (direction.x === 0) direction = {x: 20, y: 0};
            break;
        }
      });

      // Start game
      gameRunning = true;
      gameLoop = setInterval(gameUpdate, gameSpeed);
    }

    // Simple 2048 Game Implementation
    function init2048Game(ctx, canvas) {
      let board = Array(4).fill().map(() => Array(4).fill(0));
      let score = 0;

      function drawBoard() {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const cellSize = 140;
        const padding = 10;

        for (let i = 0; i < 4; i++) {
          for (let j = 0; j < 4; j++) {
            const x = j * cellSize + padding;
            const y = i * cellSize + padding;
            
            ctx.fillStyle = board[i][j] === 0 ? '#333' : '#666';
            ctx.fillRect(x, y, cellSize - padding, cellSize - padding);
            
            if (board[i][j] !== 0) {
              ctx.fillStyle = '#fff';
              ctx.font = '24px Arial';
              ctx.textAlign = 'center';
              ctx.fillText(board[i][j], x + cellSize/2, y + cellSize/2 + 8);
            }
          }
        }
      }

      function addRandomTile() {
        const emptyCells = [];
        for (let i = 0; i < 4; i++) {
          for (let j = 0; j < 4; j++) {
            if (board[i][j] === 0) {
              emptyCells.push({i, j});
            }
          }
        }
        
        if (emptyCells.length > 0) {
          const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
          board[randomCell.i][randomCell.j] = Math.random() < 0.9 ? 2 : 4;
        }
      }

      function updateScore() {
        gameScore = score;
        document.getElementById('gameScore').textContent = `Score: ${score}`;
      }

      function gameUpdate() {
        if (!gameRunning || gamePaused) return;
        drawBoard();
      }

      // Event listeners
      document.addEventListener('keydown', (e) => {
        if (!gameRunning) return;
        
        let moved = false;
        switch(e.key) {
          case 'ArrowUp':
            moved = moveUp();
            break;
          case 'ArrowDown':
            moved = moveDown();
            break;
          case 'ArrowLeft':
            moved = moveLeft();
            break;
          case 'ArrowRight':
            moved = moveRight();
            break;
        }
        
        if (moved) {
          addRandomTile();
          updateScore();
        }
      });

      function moveUp() {
        let moved = false;
        for (let j = 0; j < 4; j++) {
          for (let i = 1; i < 4; i++) {
            if (board[i][j] !== 0) {
              let k = i;
              while (k > 0 && board[k-1][j] === 0) {
                board[k-1][j] = board[k][j];
                board[k][j] = 0;
                k--;
                moved = true;
              }
              if (k > 0 && board[k-1][j] === board[k][j]) {
                board[k-1][j] *= 2;
                score += board[k-1][j];
                board[k][j] = 0;
                moved = true;
              }
            }
          }
        }
        return moved;
      }

      function moveDown() {
        let moved = false;
        for (let j = 0; j < 4; j++) {
          for (let i = 2; i >= 0; i--) {
            if (board[i][j] !== 0) {
              let k = i;
              while (k < 3 && board[k+1][j] === 0) {
                board[k+1][j] = board[k][j];
                board[k][j] = 0;
                k++;
                moved = true;
              }
              if (k < 3 && board[k+1][j] === board[k][j]) {
                board[k+1][j] *= 2;
                score += board[k+1][j];
                board[k][j] = 0;
                moved = true;
              }
            }
          }
        }
        return moved;
      }

      function moveLeft() {
        let moved = false;
        for (let i = 0; i < 4; i++) {
          for (let j = 1; j < 4; j++) {
            if (board[i][j] !== 0) {
              let k = j;
              while (k > 0 && board[i][k-1] === 0) {
                board[i][k-1] = board[i][k];
                board[i][k] = 0;
                k--;
                moved = true;
              }
              if (k > 0 && board[i][k-1] === board[i][k]) {
                board[i][k-1] *= 2;
                score += board[i][k-1];
                board[i][k] = 0;
                moved = true;
              }
            }
          }
        }
        return moved;
      }

      function moveRight() {
        let moved = false;
        for (let i = 0; i < 4; i++) {
          for (let j = 2; j >= 0; j--) {
            if (board[i][j] !== 0) {
              let k = j;
              while (k < 3 && board[i][k+1] === 0) {
                board[i][k+1] = board[i][k];
                board[i][k] = 0;
                k++;
                moved = true;
              }
              if (k < 3 && board[i][k+1] === board[i][k]) {
                board[i][k+1] *= 2;
                score += board[i][k+1];
                board[i][k] = 0;
                moved = true;
              }
            }
          }
        }
        return moved;
      }

      // Initialize game
      addRandomTile();
      addRandomTile();
      gameRunning = true;
      gameLoop = setInterval(gameUpdate, 100);
    }

    // Placeholder implementations for other games
    function initTetrisGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Tetris Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initAimGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Aim Trainer Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initMemoryGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Memory Game Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initTypingGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Typing Test Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initChessGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Chess Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initSpaceGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Space Invaders Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initRacingGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Racing Game Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initBasketballGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Basketball Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    // Flappy Bird Implementation
    function initFlappyGame(ctx, canvas) {
      let bird = { x: 100, y: canvas.height/2, velocity: 0 };
      let pipes = [];
      let score = 0;
      let gameSpeed = 2;

      function drawBird() {
        ctx.fillStyle = '#ffeb3b';
        ctx.fillRect(bird.x, bird.y, 30, 30);
        ctx.fillStyle = '#ff9800';
        ctx.fillRect(bird.x + 20, bird.y + 10, 10, 10);
      }

      function drawPipes() {
        ctx.fillStyle = '#4caf50';
        pipes.forEach(pipe => {
          ctx.fillRect(pipe.x, 0, 50, pipe.topHeight);
          ctx.fillRect(pipe.x, pipe.bottomY, 50, canvas.height - pipe.bottomY);
        });
      }

      function updateBird() {
        bird.velocity += 0.5;
        bird.y += bird.velocity;
      }

      function updatePipes() {
        pipes.forEach(pipe => {
          pipe.x -= gameSpeed;
        });
        pipes = pipes.filter(pipe => pipe.x > -50);

        if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 200) {
          const topHeight = Math.random() * (canvas.height - 200) + 50;
          pipes.push({
            x: canvas.width,
            topHeight: topHeight,
            bottomY: topHeight + 150
          });
        }
      }

      function checkCollisions() {
        if (bird.y < 0 || bird.y > canvas.height - 30) {
          endGame();
          return;
        }

        pipes.forEach(pipe => {
          if (bird.x + 30 > pipe.x && bird.x < pipe.x + 50) {
            if (bird.y < pipe.topHeight || bird.y + 30 > pipe.bottomY) {
              endGame();
              return;
            }
          }
          if (bird.x > pipe.x + 50 && !pipe.scored) {
            score += 1;
            pipe.scored = true;
            updateScore();
          }
        });
      }

      function updateScore() {
        gameScore = score;
        document.getElementById('gameScore').textContent = `Score: ${score}`;
      }

      function endGame() {
        gameRunning = false;
        if (userSystem.userData) {
          userSystem.addXP(gameConfigs.flappy.xpReward, 'game');
          userSystem.showNotification(`Game Over! Final Score: ${score}. +${gameConfigs.flappy.xpReward} XP!`, 'success');
        } else {
          userSystem.showNotification(`Game Over! Final Score: ${score}. Login to earn XP!`, 'info');
        }
      }

      function gameUpdate() {
        if (!gameRunning || gamePaused) return;

        ctx.fillStyle = '#87ceeb';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        updateBird();
        updatePipes();
        checkCollisions();

        drawPipes();
        drawBird();
      }

      // Event listeners
      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && gameRunning) {
          e.preventDefault();
          bird.velocity = -8;
        }
      });

      canvas.addEventListener('click', () => {
        if (gameRunning) {
          bird.velocity = -8;
        }
      });

      gameRunning = true;
      gameLoop = setInterval(gameUpdate, 20);
    }

    // Pac-Man Implementation
    function initPacmanGame(ctx, canvas) {
      let pacman = { x: 100, y: 100, direction: 'right', mouth: 0 };
      let dots = [];
      let ghosts = [];
      let score = 0;

      // Initialize dots
      for (let i = 0; i < 20; i++) {
        for (let j = 0; j < 15; j++) {
          dots.push({ x: j * 30 + 15, y: i * 20 + 15, eaten: false });
        }
      }

      // Initialize ghosts
      ghosts.push({ x: 200, y: 200, color: 'red' });
      ghosts.push({ x: 300, y: 200, color: 'pink' });

      function drawPacman() {
        ctx.fillStyle = '#ffff00';
        ctx.beginPath();
        ctx.arc(pacman.x, pacman.y, 15, 0, Math.PI * 2);
        ctx.fill();

        // Draw mouth
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(pacman.x, pacman.y, 15, pacman.mouth, Math.PI * 2 - pacman.mouth);
        ctx.lineTo(pacman.x, pacman.y);
        ctx.fill();
      }

      function drawDots() {
        ctx.fillStyle = '#fff';
        dots.forEach(dot => {
          if (!dot.eaten) {
            ctx.beginPath();
            ctx.arc(dot.x, dot.y, 3, 0, Math.PI * 2);
            ctx.fill();
          }
        });
      }

      function drawGhosts() {
        ghosts.forEach(ghost => {
          ctx.fillStyle = ghost.color;
          ctx.fillRect(ghost.x - 10, ghost.y - 10, 20, 20);
        });
      }

      function updatePacman() {
        switch(pacman.direction) {
          case 'right':
            pacman.x += 2;
            pacman.mouth = 0;
            break;
          case 'left':
            pacman.x -= 2;
            pacman.mouth = Math.PI;
            break;
          case 'up':
            pacman.y -= 2;
            pacman.mouth = Math.PI * 1.5;
            break;
          case 'down':
            pacman.y += 2;
            pacman.mouth = Math.PI * 0.5;
            break;
        }

        // Wrap around screen
        if (pacman.x > canvas.width) pacman.x = 0;
        if (pacman.x < 0) pacman.x = canvas.width;
        if (pacman.y > canvas.height) pacman.y = 0;
        if (pacman.y < 0) pacman.y = canvas.height;
      }

      function checkDotCollisions() {
        dots.forEach(dot => {
          if (!dot.eaten) {
            const distance = Math.sqrt((pacman.x - dot.x) ** 2 + (pacman.y - dot.y) ** 2);
            if (distance < 18) {
              dot.eaten = true;
              score += 10;
              updateScore();
            }
          }
        });
      }

      function updateScore() {
        gameScore = score;
        document.getElementById('gameScore').textContent = `Score: ${score}`;
      }

      function gameUpdate() {
        if (!gameRunning || gamePaused) return;

        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        updatePacman();
        checkDotCollisions();

        drawDots();
        drawPacman();
        drawGhosts();
      }

      // Event listeners
      document.addEventListener('keydown', (e) => {
        if (!gameRunning) return;
        switch(e.key) {
          case 'ArrowUp':
            pacman.direction = 'up';
            break;
          case 'ArrowDown':
            pacman.direction = 'down';
            break;
          case 'ArrowLeft':
            pacman.direction = 'left';
            break;
          case 'ArrowRight':
            pacman.direction = 'right';
            break;
        }
      });

      gameRunning = true;
      gameLoop = setInterval(gameUpdate, 50);
    }

    // Subway Surfers Implementation
    function initSubwayGame(ctx, canvas) {
      let runner = { x: 100, y: canvas.height - 100, width: 30, height: 50, velocityY: 0, onGround: false };
      let obstacles = [];
      let coins = [];
      let score = 0;
      let gameSpeed = 3;
      let jumpPower = -12;
      let gravity = 0.6;

      function drawRunner() {
        // Draw runner body
        ctx.fillStyle = '#ff6b35';
        ctx.fillRect(runner.x, runner.y, runner.width, runner.height);
        
        // Draw head
        ctx.fillStyle = '#ffdbac';
        ctx.fillRect(runner.x + 5, runner.y - 15, 20, 15);
        
        // Draw arms
        ctx.fillStyle = '#ffdbac';
        ctx.fillRect(runner.x - 5, runner.y + 10, 10, 20);
        ctx.fillRect(runner.x + 25, runner.y + 10, 10, 20);
        
        // Draw legs
        ctx.fillStyle = '#4a4a4a';
        ctx.fillRect(runner.x + 5, runner.y + runner.height, 8, 15);
        ctx.fillRect(runner.x + 17, runner.y + runner.height, 8, 15);
      }

      function drawObstacles() {
        ctx.fillStyle = '#8b4513';
        obstacles.forEach(obstacle => {
          ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
        });
      }

      function drawCoins() {
        ctx.fillStyle = '#ffd700';
        coins.forEach(coin => {
          ctx.beginPath();
          ctx.arc(coin.x, coin.y, coin.radius, 0, Math.PI * 2);
          ctx.fill();
          
          // Draw coin shine
          ctx.fillStyle = '#ffff00';
          ctx.beginPath();
          ctx.arc(coin.x - 3, coin.y - 3, 3, 0, Math.PI * 2);
          ctx.fill();
          ctx.fillStyle = '#ffd700';
        });
      }

      function updateRunner() {
        // Apply gravity
        runner.velocityY += gravity;
        runner.y += runner.velocityY;

        // Ground collision
        if (runner.y >= canvas.height - 100) {
          runner.y = canvas.height - 100;
          runner.velocityY = 0;
          runner.onGround = true;
        } else {
          runner.onGround = false;
        }

        // Jump
        if (runner.onGround) {
          runner.velocityY = jumpPower;
        }
      }

      function updateObstacles() {
        obstacles.forEach(obstacle => {
          obstacle.x -= gameSpeed;
        });
        obstacles = obstacles.filter(obstacle => obstacle.x > -50);

        // Add new obstacles
        if (Math.random() < 0.02) {
          obstacles.push({
            x: canvas.width,
            y: canvas.height - 100,
            width: 20,
            height: 50
          });
        }
      }

      function updateCoins() {
        coins.forEach(coin => {
          coin.x -= gameSpeed;
        });
        coins = coins.filter(coin => coin.x > -20);

        // Add new coins
        if (Math.random() < 0.03) {
          coins.push({
            x: canvas.width,
            y: canvas.height - 150 + Math.random() * 100,
            radius: 8
          });
        }
      }

      function checkCollisions() {
        // Obstacle collisions
        obstacles.forEach(obstacle => {
          if (runner.x < obstacle.x + obstacle.width &&
              runner.x + runner.width > obstacle.x &&
              runner.y < obstacle.y + obstacle.height &&
              runner.y + runner.height > obstacle.y) {
            endGame();
            return;
          }
        });

        // Coin collisions
        coins.forEach((coin, index) => {
          const distance = Math.sqrt((runner.x + runner.width/2 - coin.x) ** 2 + (runner.y + runner.height/2 - coin.y) ** 2);
          if (distance < runner.width/2 + coin.radius) {
            coins.splice(index, 1);
            score += 10;
            updateScore();
          }
        });
      }

      function updateScore() {
        gameScore = score;
        document.getElementById('gameScore').textContent = `Score: ${score}`;
      }

      function endGame() {
        gameRunning = false;
        if (userSystem.userData) {
          userSystem.addXP(gameConfigs.subway.xpReward, 'game');
          userSystem.showNotification(`Game Over! Final Score: ${score}. +${gameConfigs.subway.xpReward} XP!`, 'success');
        } else {
          userSystem.showNotification(`Game Over! Final Score: ${score}. Login to earn XP!`, 'info');
        }
      }

      function gameUpdate() {
        if (!gameRunning || gamePaused) return;

        // Draw background
        ctx.fillStyle = '#87ceeb';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Draw ground
        ctx.fillStyle = '#8b4513';
        ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

        updateRunner();
        updateObstacles();
        updateCoins();
        checkCollisions();

        drawObstacles();
        drawCoins();
        drawRunner();
      }

      // Event listeners
      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && gameRunning && runner.onGround) {
          e.preventDefault();
          runner.velocityY = jumpPower;
        }
      });

      canvas.addEventListener('click', () => {
        if (gameRunning && runner.onGround) {
          runner.velocityY = jumpPower;
        }
      });

      gameRunning = true;
      gameLoop = setInterval(gameUpdate, 20);
    }

    function initSoccerGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Soccer Physics Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initTowerGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Tower Defense Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initRopeGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Cut the Rope Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    function initAngryGame(ctx, canvas) {
      ctx.fillStyle = '#fff';
      ctx.font = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Angry Birds Coming Soon!', canvas.width/2, canvas.height/2);
      gameRunning = true;
    }

    // Temple Run Implementation
    function initTempleGame(ctx, canvas) {
      let runner = { x: 200, y: canvas.height - 150, width: 30, height: 50, velocityY: 0, onGround: false, lane: 1 };
      let obstacles = [];
      let coins = [];
      let score = 0;
      let gameSpeed = 4;
      let jumpPower = -15;
      let gravity = 0.8;
      let lanes = [100, 200, 300]; // Three lanes

      function drawRunner() {
        // Draw runner body
        ctx.fillStyle = '#8b4513';
        ctx.fillRect(runner.x, runner.y, runner.width, runner.height);
        
        // Draw head
        ctx.fillStyle = '#ffdbac';
        ctx.fillRect(runner.x + 5, runner.y - 15, 20, 15);
        
        // Draw arms (running animation)
        ctx.fillStyle = '#ffdbac';
        const armOffset = Math.sin(Date.now() * 0.01) * 5;
        ctx.fillRect(runner.x - 5, runner.y + 10 + armOffset, 10, 20);
        ctx.fillRect(runner.x + 25, runner.y + 10 - armOffset, 10, 20);
        
        // Draw legs (running animation)
        ctx.fillStyle = '#4a4a4a';
        const legOffset = Math.sin(Date.now() * 0.01) * 3;
        ctx.fillRect(runner.x + 5, runner.y + runner.height + legOffset, 8, 15);
        ctx.fillRect(runner.x + 17, runner.y + runner.height - legOffset, 8, 15);
      }

      function drawObstacles() {
        ctx.fillStyle = '#654321';
        obstacles.forEach(obstacle => {
          if (obstacle.type === 'low') {
            ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
          } else if (obstacle.type === 'high') {
            ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            // Draw top part
            ctx.fillRect(obstacle.x + 5, obstacle.y - 20, obstacle.width - 10, 20);
          }
        });
      }

      function drawCoins() {
        ctx.fillStyle = '#ffd700';
        coins.forEach(coin => {
          ctx.beginPath();
          ctx.arc(coin.x, coin.y, coin.radius, 0, Math.PI * 2);
          ctx.fill();
          
          // Draw coin shine
          ctx.fillStyle = '#ffff00';
          ctx.beginPath();
          ctx.arc(coin.x - 3, coin.y - 3, 3, 0, Math.PI * 2);
          ctx.fill();
          ctx.fillStyle = '#ffd700';
        });
      }

      function updateRunner() {
        // Apply gravity
        runner.velocityY += gravity;
        runner.y += runner.velocityY;

        // Ground collision
        if (runner.y >= canvas.height - 150) {
          runner.y = canvas.height - 150;
          runner.velocityY = 0;
          runner.onGround = true;
        } else {
          runner.onGround = false;
        }

        // Update lane position
        runner.x = lanes[runner.lane];
      }

      function updateObstacles() {
        obstacles.forEach(obstacle => {
          obstacle.x -= gameSpeed;
        });
        obstacles = obstacles.filter(obstacle => obstacle.x > -50);

        // Add new obstacles
        if (Math.random() < 0.03) {
          const lane = Math.floor(Math.random() * 3);
          const type = Math.random() < 0.5 ? 'low' : 'high';
          obstacles.push({
            x: canvas.width,
            y: type === 'low' ? canvas.height - 100 : canvas.height - 120,
            width: 20,
            height: type === 'low' ? 50 : 70,
            type: type,
            lane: lane
          });
        }
      }

      function updateCoins() {
        coins.forEach(coin => {
          coin.x -= gameSpeed;
        });
        coins = coins.filter(coin => coin.x > -20);

        // Add new coins
        if (Math.random() < 0.04) {
          const lane = Math.floor(Math.random() * 3);
          coins.push({
            x: canvas.width,
            y: canvas.height - 180 + Math.random() * 50,
            radius: 8,
            lane: lane
          });
        }
      }

      function checkCollisions() {
        // Obstacle collisions
        obstacles.forEach(obstacle => {
          if (obstacle.lane === runner.lane &&
              runner.x < obstacle.x + obstacle.width &&
              runner.x + runner.width > obstacle.x &&
              runner.y < obstacle.y + obstacle.height &&
              runner.y + runner.height > obstacle.y) {
            endGame();
            return;
          }
        });

        // Coin collisions
        coins.forEach((coin, index) => {
          if (coin.lane === runner.lane) {
            const distance = Math.sqrt((runner.x + runner.width/2 - coin.x) ** 2 + (runner.y + runner.height/2 - coin.y) ** 2);
            if (distance < runner.width/2 + coin.radius) {
              coins.splice(index, 1);
              score += 10;
              updateScore();
            }
          }
        });
      }

      function updateScore() {
        gameScore = score;
        document.getElementById('gameScore').textContent = `Score: ${score}`;
      }

      function endGame() {
        gameRunning = false;
        if (userSystem.userData) {
          userSystem.addXP(gameConfigs.temple.xpReward, 'game');
          userSystem.showNotification(`Game Over! Final Score: ${score}. +${gameConfigs.temple.xpReward} XP!`, 'success');
        } else {
          userSystem.showNotification(`Game Over! Final Score: ${score}. Login to earn XP!`, 'info');
        }
      }

      function gameUpdate() {
        if (!gameRunning || gamePaused) return;

        // Draw background (temple theme)
        ctx.fillStyle = '#8b4513';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Draw ground
        ctx.fillStyle = '#654321';
        ctx.fillRect(0, canvas.height - 100, canvas.width, 100);

        updateRunner();
        updateObstacles();
        updateCoins();
        checkCollisions();

        drawObstacles();
        drawCoins();
        drawRunner();
      }

      // Event listeners
      document.addEventListener('keydown', (e) => {
        if (!gameRunning) return;
        
        switch(e.key) {
          case 'ArrowLeft':
            if (runner.lane > 0) runner.lane--;
            break;
          case 'ArrowRight':
            if (runner.lane < 2) runner.lane++;
            break;
          case 'ArrowUp':
          case ' ':
            if (runner.onGround) {
              e.preventDefault();
              runner.velocityY = jumpPower;
            }
            break;
          case 'ArrowDown':
            // Slide (crouch)
            runner.height = 25;
            setTimeout(() => { runner.height = 50; }, 500);
            break;
        }
      });

      gameRunning = true;
      gameLoop = setInterval(gameUpdate, 20);
    }

    // Fruit Ninja Implementation
    function initFruitGame(ctx, canvas) {
      let fruits = [];
      let bombs = [];
      let score = 0;
      let lives = 3;
      let mouseX = 0;
      let mouseY = 0;
      let gameTime = 60; // 60 seconds

      function drawFruits() {
        fruits.forEach(fruit => {
          ctx.fillStyle = fruit.color;
          ctx.beginPath();
          ctx.arc(fruit.x, fruit.y, fruit.radius, 0, Math.PI * 2);
          ctx.fill();
          
          // Draw fruit details
          ctx.fillStyle = '#fff';
          ctx.font = '12px Arial';
          ctx.textAlign = 'center';
          ctx.fillText(fruit.emoji, fruit.x, fruit.y + 4);
        });
      }

      function drawBombs() {
        bombs.forEach(bomb => {
          ctx.fillStyle = '#333';
          ctx.beginPath();
          ctx.arc(bomb.x, bomb.y, bomb.radius, 0, Math.PI * 2);
          ctx.fill();
          
          ctx.fillStyle = '#f00';
          ctx.font = '12px Arial';
          ctx.textAlign = 'center';
          ctx.fillText('üí£', bomb.x, bomb.y + 4);
        });
      }

      function updateFruits() {
        fruits.forEach(fruit => {
          fruit.y += fruit.velocityY;
          fruit.x += fruit.velocityX;
          fruit.velocityY += 0.3; // gravity
        });
        fruits = fruits.filter(fruit => fruit.y < canvas.height + 50);

        // Add new fruits
        if (Math.random() < 0.1) {
          const fruitTypes = [
            { emoji: 'üçé', color: '#ff0000' },
            { emoji: 'üçå', color: '#ffff00' },
            { emoji: 'üçä', color: '#ffa500' },
            { emoji: 'üçá', color: '#800080' },
            { emoji: 'üçì', color: '#ff69b4' }
          ];
          const fruit = fruitTypes[Math.floor(Math.random() * fruitTypes.length)];
          fruits.push({
            x: Math.random() * canvas.width,
            y: canvas.height + 20,
            radius: 20,
            velocityY: -8 - Math.random() * 5,
            velocityX: (Math.random() - 0.5) * 2,
            emoji: fruit.emoji,
            color: fruit.color
          });
        }
      }

      function updateBombs() {
        bombs.forEach(bomb => {
          bomb.y += bomb.velocityY;
          bomb.x += bomb.velocityX;
          bomb.velocityY += 0.3;
        });
        bombs = bombs.filter(bomb => bomb.y < canvas.height + 50);

        // Add new bombs
        if (Math.random() < 0.05) {
          bombs.push({
            x: Math.random() * canvas.width,
            y: canvas.height + 20,
            radius: 15,
            velocityY: -6 - Math.random() * 3,
            velocityX: (Math.random() - 0.5) * 2
          });
        }
      }

      function checkSlices() {
        // Check fruit slices
        fruits.forEach((fruit, index) => {
          const distance = Math.sqrt((mouseX - fruit.x) ** 2 + (mouseY - fruit.y) ** 2);
          if (distance < fruit.radius + 20) {
            fruits.splice(index, 1);
            score += 10;
            updateScore();
          }
        });

        // Check bomb hits
        bombs.forEach((bomb, index) => {
          const distance = Math.sqrt((mouseX - bomb.x) ** 2 + (mouseY - bomb.y) ** 2);
          if (distance < bomb.radius + 20) {
            bombs.splice(index, 1);
            lives--;
            if (lives <= 0) {
              endGame();
            }
          }
        });
      }

      function updateScore() {
        gameScore = score;
        document.getElementById('gameScore').textContent = `Score: ${score} | Lives: ${lives} | Time: ${Math.ceil(gameTime)}`;
      }

      function endGame() {
        gameRunning = false;
        if (userSystem.userData) {
          userSystem.addXP(gameConfigs.fruit.xpReward, 'game');
          userSystem.showNotification(`Game Over! Final Score: ${score}. +${gameConfigs.fruit.xpReward} XP!`, 'success');
        } else {
          userSystem.showNotification(`Game Over! Final Score: ${score}. Login to earn XP!`, 'info');
        }
      }

      function gameUpdate() {
        if (!gameRunning || gamePaused) return;

        gameTime -= 1/60;
        if (gameTime <= 0) {
          endGame();
          return;
        }

        // Draw background
        ctx.fillStyle = '#87ceeb';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        updateFruits();
        updateBombs();
        checkSlices();

        drawFruits();
        drawBombs();
        updateScore();
      }

      // Mouse tracking
      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;
      });

      canvas.addEventListener('click', () => {
        checkSlices();
      });

      gameRunning = true;
      gameLoop = setInterval(gameUpdate, 16);
    }

    // Game control functions
    function restartGame() {
      if (currentGame) {
        initGame(currentGame);
      }
    }

    function pauseGame() {
      gamePaused = !gamePaused;
      const pauseBtn = document.getElementById('pauseBtn');
      pauseBtn.textContent = gamePaused ? 'Resume' : 'Pause';
    }

    // Close game modal
    document.getElementById('closeGameModal').addEventListener('click', () => {
      if (gameLoop) {
        clearInterval(gameLoop);
        gameLoop = null;
      }
      gameRunning = false;
      document.getElementById('gameModal').classList.remove('active');
    });


    // ===== HTML5 GAME (TRUCK SPACE 2) =====
    
    function initHTML5Game(ctx, canvas) {
      // Get the game content area
      const gameContent = document.querySelector('.game-content');
      
      // Clear any existing content
      gameContent.innerHTML = '';
      
      // Use G+ Games bypass method - multiple proxy sources
      const proxyUrls = [
        'https://1v1.lol',
        'https://www.1v1.lol',
        'https://1v1.lol/play',
        'https://www.1v1.lol/play',
        'https://1v1.lol/game',
        'https://www.1v1.lol/game'
      ];
      
      let currentProxyIndex = 0;
      
      const tryLoadGame = () => {
        if (currentProxyIndex >= proxyUrls.length) {
          // All proxies failed, show fallback
          gameContent.innerHTML = `
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: white; text-align: center; padding: 20px; background: linear-gradient(135deg, #0a1222, #1a2332);">
              <h2 style="color: #64a0ff; margin-bottom: 20px;">üéÆ 1v1.LOL Game</h2>
              <p style="margin-bottom: 30px; color: #8fb0d9;">Chrome is blocking the game. Try these alternatives:</p>
              <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;">
                <button onclick="window.open('https://1v1.lol', '_blank')" style="padding: 12px 24px; background: var(--viz); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                  Open 1v1.LOL
                </button>
                <button onclick="window.open('https://www.1v1.lol', '_blank')" style="padding: 12px 24px; background: #666; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                  Alternative Link
                </button>
                <button onclick="start1v1Game(document.getElementById('gameCanvas'))" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                  Play Custom Game
                </button>
              </div>
              <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 20px; max-width: 500px;">
                <h4 style="color: #64a0ff; margin: 0 0 10px 0;">Why This Happens:</h4>
                <ul style="text-align: left; margin: 0; padding-left: 20px; color: #8fb0d9; font-size: 14px;">
                  <li>Chrome blocks certain game sites for security</li>
                  <li>School/work networks often block gaming sites</li>
                  <li>Try opening in a new tab or different browser</li>
                  <li>Use the custom game as a working alternative</li>
                </ul>
              </div>
            </div>
          `;
          return;
        }
        
        const currentUrl = proxyUrls[currentProxyIndex];
        console.log(`Trying proxy ${currentProxyIndex + 1}: ${currentUrl}`);
        
        gameContent.innerHTML = `
          <div style="width: 100%; height: 100%; position: relative; background: #000;">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center; z-index: 1000;">
              <div style="margin-bottom: 20px;">
                <div style="width: 40px; height: 40px; border: 4px solid #64a0ff; border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
              </div>
              <p>Loading 1v1.LOL...</p>
              <p style="font-size: 12px; color: #8fb0d9;">Trying source ${currentProxyIndex + 1}/${proxyUrls.length}</p>
            </div>
            <iframe 
              src="${currentUrl}" 
              style="width: 100%; height: 100%; border: none; background: #000;"
              allowfullscreen
              allow="autoplay; fullscreen; microphone; camera; gamepad"
              sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"
              onload="console.log('Iframe loaded successfully from ${currentUrl}')"
              onerror="console.log('Iframe failed to load from ${currentUrl}'); setTimeout(() => { currentProxyIndex++; tryLoadGame(); }, 2000);"
            ></iframe>
            <div style="position: absolute; top: 10px; right: 10px; z-index: 1000;">
              <button onclick="window.open('${currentUrl}', '_blank')" style="padding: 8px 16px; background: rgba(0,0,0,0.7); color: white; border: 1px solid #64a0ff; border-radius: 4px; cursor: pointer; font-size: 12px;">
                Open in New Tab
              </button>
            </div>
          </div>
        `;
        
        // If iframe doesn't load within 5 seconds, try next proxy
        setTimeout(() => {
          currentProxyIndex++;
          tryLoadGame();
        }, 5000);
      };
      
      // Start trying to load the game
      tryLoadGame();
      
      // Award XP when game starts
      if (userSystem.userData) {
        userSystem.addXP(gameConfigs.html5.xpReward, 'game');
        userSystem.showNotification(`Game started! +${gameConfigs.html5.xpReward} XP!`, 'success');
      } else {
        userSystem.showNotification('Game started! Login to earn XP!', 'info');
      }
      
      // Store cleanup function
      window.cleanupHTML5Game = () => {
        // Clean up Unity game instance
        if (window.unityGameInstance) {
          try {
            window.unityGameInstance.Quit();
          } catch (e) {
            console.log('Unity cleanup error:', e);
          }
          window.unityGameInstance = null;
        }
        
        // Remove Unity scripts
        const scripts = document.querySelectorAll('script[src*="UnityProgress"], script[src*="2.7.js"]');
        scripts.forEach(script => {
          if (script.parentNode) {
            script.parentNode.removeChild(script);
          }
        });
        
        // Restore original canvas
        gameContent.innerHTML = '<canvas id="gameCanvas" width="800" height="600" style="border: none; background: #000;"></canvas>';
      };
    }

    // ===== PANIC BUTTON FUNCTION =====
    
    function panicButton() {
      // Add a small delay to make it look more realistic
      userSystem.showNotification('Redirecting to Google Classroom...', 'info');
      setTimeout(() => {
        window.open('https://classroom.google.com', '_blank');
      }, 500);
    }

    // ===== GAME MODAL CONTROLS =====
    
    function resizeGameModal(size) {
      const modal = document.getElementById('gameModalContent');
      const gameContainer = document.querySelector('.game-content');
      
      switch(size) {
        case 'small':
          modal.style.width = '500px';
          modal.style.height = '400px';
          gameContainer.style.height = '300px';
          break;
        case 'medium':
          modal.style.width = '800px';
          modal.style.height = '600px';
          gameContainer.style.height = '500px';
          break;
        case 'large':
          modal.style.width = '1000px';
          modal.style.height = '700px';
          gameContainer.style.height = '600px';
          break;
      }
    }
    
    function toggleFullscreen() {
      const modal = document.getElementById('gameModalContent');
      if (modal.style.position === 'fixed') {
        // Exit fullscreen
        modal.style.position = 'relative';
        modal.style.top = 'auto';
        modal.style.left = 'auto';
        modal.style.width = '800px';
        modal.style.height = '600px';
        modal.style.zIndex = 'auto';
        modal.style.margin = 'auto';
      } else {
        // Enter fullscreen
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.width = '100vw';
        modal.style.height = '100vh';
        modal.style.zIndex = '10000';
        modal.style.margin = '0';
        document.querySelector('.game-content').style.height = 'calc(100vh - 200px)';
      }
    }
    
    // Make modal draggable
    let isDragging = false;
    let dragOffset = { x: 0, y: 0 };
    
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('gameModalContent');
      const header = modal.querySelector('.modal-header');
      
      header.addEventListener('mousedown', function(e) {
        isDragging = true;
        const rect = modal.getBoundingClientRect();
        dragOffset.x = e.clientX - rect.left;
        dragOffset.y = e.clientY - rect.top;
        modal.style.position = 'fixed';
        modal.style.margin = '0';
      });
      
      document.addEventListener('mousemove', function(e) {
        if (isDragging) {
          modal.style.left = (e.clientX - dragOffset.x) + 'px';
          modal.style.top = (e.clientY - dragOffset.y) + 'px';
        }
      });
      
      document.addEventListener('mouseup', function() {
        isDragging = false;
      });
    });


    // Particles
    const canvas = document.getElementById('particle-network');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      initParticles();
    }
    function initParticles() {
      particles = [];
      const count = Math.floor((canvas.width * canvas.height) / 15000);
      for (let i=0;i<count;i++){
        particles.push({
          x: Math.random()*canvas.width,
          y: Math.random()*canvas.height,
          size: Math.random()*2+0.5,
          speedX: Math.random()*0.5-0.25,
          speedY: Math.random()*0.5-0.25,
          color: `rgba(100,160,255,${Math.random()*0.3+0.1})`
        });
      }
    }
    function drawParticles() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for (let i=0;i<particles.length;i++){
        for (let j=i+1;j<particles.length;j++){
          const dx=particles[i].x-particles[j].x;
          const dy=particles[i].y-particles[j].y;
          const dist=Math.sqrt(dx*dx+dy*dy);
          if(dist<100){
            ctx.beginPath();
            ctx.strokeStyle=`rgba(100,160,255,${0.2-dist/500})`;
            ctx.lineWidth=0.5;
            ctx.moveTo(particles[i].x,particles[i].y);
            ctx.lineTo(particles[j].x,particles[j].y);
            ctx.stroke();
          }
        }
        ctx.beginPath();
        ctx.arc(particles[i].x,particles[i].y,particles[i].size,0,Math.PI*2);
        ctx.fillStyle=particles[i].color;
        ctx.fill();
        particles[i].x+=particles[i].speedX;
        particles[i].y+=particles[i].speedY;
        if(particles[i].x<0||particles[i].x>canvas.width)particles[i].speedX*=-1;
        if(particles[i].y<0||particles[i].y>canvas.height)particles[i].speedY*=-1;
      }
      requestAnimationFrame(drawParticles);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    drawParticles();
  </script>

  <!-- Changelogfy Widget -->
  <div id="changelogfy-client" class="changelogfy-client">
    <iframe id="changelogfy-iframe-widget" class="changelogfy-iframe-widget"></iframe>
    <iframe id="changelogfy-iframe-nps" class="changelogfy-iframe-nps"></iframe>
    <iframe id="changelogfy-iframe-announcement" class="changelogfy-iframe-announcement"></iframe>
    <div id="changelogfy-backdrop" class="changelogfy-backdrop"></div>
    <div id="changelogfy-launcher" class="changelogfy-launcher" style="bottom: 20px; right: 20px; background: rgb(174, 0, 255);">
      <svg xmlns="http://www.w3.org/2000/svg" class="changelogfy-launcher" fill="#ffffff" viewBox="0 0 24 24" stroke="#ffffff" stroke-width="2" height="24" width="24">
        <path class="changelogfy-launcher" stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
          <a href="https://vizualnetwork.changelogfy.com" target="_blank" class="changelogfy-badge-container show">
            <div class="changelogfy-badge">
              <span class="changelogfy-badge-counter">3</span>
            </div>
          </a>
        </path>
      </svg>
    </div>
  </div>

  <!-- Enhanced Blocking Evasion JavaScript -->
  <script>
    // ===== ENHANCED BLOCKING EVASION SYSTEM =====
    
    // Global variables for enhanced features
    let enhancedSettings = {
      stealthMode: true,
      autoProxyFallback: true,
      humanBehavior: false,
      randomDelays: true,
      hideAds: false,
      analytics: true,
      autoHttps: true,
      blockScripts: false
    };

    // ===== STEALTH MODE & BLOCKING EVASION =====
    function initializeStealthMode() {
      // Randomize user agent strings to avoid detection
      const userAgents = [
        'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
        'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
        'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0',
        'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:121.0) Gecko/20100101 Firefox/121.0'
      ];
      
      // Set random user agent
      Object.defineProperty(navigator, 'userAgent', {
        get: function() { return userAgents[Math.floor(Math.random() * userAgents.length)]; }
      });

      // Disable common detection methods
      window.chrome = undefined;
      window.webdriver = undefined;
      window.__webdriver_script_fn = undefined;
      window.__selenium_unwrapped = undefined;
      window.__webdriver_unwrapped = undefined;
      window.__driver_evaluate = undefined;
      window.__webdriver_evaluate = undefined;
      window.__selenium_evaluate = undefined;
      window.__fxdriver_evaluate = undefined;
      window.__driver_unwrapped = undefined;
      window.__fxdriver_unwrapped = undefined;

      // Randomize screen properties
      Object.defineProperty(screen, 'width', { get: () => 1920 + Math.floor(Math.random() * 100) });
      Object.defineProperty(screen, 'height', { get: () => 1080 + Math.floor(Math.random() * 100) });
      Object.defineProperty(screen, 'availWidth', { get: () => 1920 + Math.floor(Math.random() * 100) });
      Object.defineProperty(screen, 'availHeight', { get: () => 1040 + Math.floor(Math.random() * 100) });

      // Randomize timezone
      const timezones = ['America/New_York', 'America/Chicago', 'America/Denver', 'America/Los_Angeles', 'Europe/London', 'Europe/Paris', 'Asia/Tokyo'];
      Object.defineProperty(Intl.DateTimeFormat.prototype, 'resolvedOptions', {
        value: function() { return { timeZone: timezones[Math.floor(Math.random() * timezones.length)] }; }
      });

      console.log('üïµÔ∏è Stealth mode activated - Enhanced blocking evasion enabled');
    }

    // Detect common blocking systems
    function detectBlockingSystem() {
      const blockingSigns = [];
      
      // Check for common blocking indicators
      if (window.location.hostname.includes('lightspeed')) blockingSigns.push('Lightspeed');
      if (window.location.hostname.includes('securly')) blockingSigns.push('Securly');
      if (window.location.hostname.includes('googlesafebrowsing')) blockingSigns.push('Google Safe Browsing');
      if (document.title.includes('blocked')) blockingSigns.push('Content Filter');
      if (document.body.innerHTML.includes('blocked') || document.body.innerHTML.includes('restricted')) blockingSigns.push('Network Filter');
      
      // Check for common blocking scripts
      const scripts = Array.from(document.scripts);
      scripts.forEach(script => {
        if (script.src.includes('lightspeed') || script.src.includes('securly')) {
          blockingSigns.push('Filtering Script Detected');
        }
      });

      if (blockingSigns.length > 0) {
        console.log('üö® Blocking system detected:', blockingSigns.join(', '));
        showToast(`Blocking system detected: ${blockingSigns.join(', ')}. Enhanced evasion activated.`, 'warning', 'Stealth');
        activateAdvancedEvasion();
      }
    }

    // Activate advanced evasion techniques
    function activateAdvancedEvasion() {
      // Add random delays to avoid pattern detection
      const originalLoadUrl = loadUrl;
      loadUrl = function() {
        const delay = Math.random() * 2000 + 1000; // 1-3 second delay
        setTimeout(() => {
          originalLoadUrl.apply(this, arguments);
        }, delay);
      };

      // Randomize request timing
      const originalFetch = window.fetch;
      window.fetch = function() {
        const delay = Math.random() * 1000 + 500; // 0.5-1.5 second delay
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            originalFetch.apply(this, arguments).then(resolve).catch(reject);
          }, delay);
        });
      };

      // Add fake mouse movements to simulate human behavior
      if (enhancedSettings.humanBehavior) {
        simulateHumanBehavior();
      }
    }

    // Simulate human-like behavior
    function simulateHumanBehavior() {
      let mouseX = 0, mouseY = 0;
      
      // Random mouse movements
      setInterval(() => {
        mouseX += (Math.random() - 0.5) * 10;
        mouseY += (Math.random() - 0.5) * 10;
        
        // Keep within bounds
        mouseX = Math.max(0, Math.min(window.innerWidth, mouseX));
        mouseY = Math.max(0, Math.min(window.innerHeight, mouseY));
        
        // Simulate mouse move event
        const event = new MouseEvent('mousemove', {
          clientX: mouseX,
          clientY: mouseY,
          bubbles: true
        });
        document.dispatchEvent(event);
      }, Math.random() * 5000 + 2000); // Every 2-7 seconds

      // Random scrolling
      setInterval(() => {
        if (Math.random() > 0.7) { // 30% chance
          window.scrollBy(0, (Math.random() - 0.5) * 100);
        }
      }, Math.random() * 10000 + 5000); // Every 5-15 seconds
    }

    // ===== PROXY FUNCTIONALITY =====
    function showProxy() {
      document.getElementById('proxyContainer').style.display = 'block';
      showToast('Browser opened', 'info', 'Browser');
    }

    function hideProxy() {
      document.getElementById('proxyContainer').style.display = 'none';
      showToast('Browser closed', 'info', 'Browser');
    }

    function loadUrl() {
      const urlInput = document.getElementById('urlBar');
      let url = urlInput.value.trim();
      
      if (!url) {
        showToast('Please enter a URL', 'warning', 'Browser');
        return;
      }

      // Add protocol if missing
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = enhancedSettings.autoHttps ? 'https://' + url : 'http://' + url;
      }

      // Update URL bar
      urlInput.value = url;
      
      // Load in iframe with enhanced blocking evasion
      const iframe = document.getElementById('proxyFrame');
      
      // Enhanced blocking evasion techniques
      iframe.onload = function() {
        try {
          // Attempt to bypass common iframe restrictions
          iframe.contentWindow.focus();
          
          // Add sandbox attributes for better compatibility
          iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation');
          
          // Set referrer policy to avoid detection
          iframe.setAttribute('referrerpolicy', 'no-referrer');
          
          showToast(`Successfully loaded ${url}`, 'success', 'Browser');
        } catch (e) {
          // If direct access fails, try proxy methods
          handleBlockedContent(url);
        }
      };
      
      iframe.onerror = function() {
        handleBlockedContent(url);
      };
      
      // Set iframe source
      iframe.src = url;
      
      showToast(`Loading ${url}...`, 'info', 'Browser');
    }

    // Enhanced blocking detection and evasion
    function handleBlockedContent(url) {
      if (!enhancedSettings.autoProxyFallback) return;
      
      showToast('Content blocked, trying alternative methods...', 'warning', 'Proxy');
      
      // Try multiple proxy methods
      const proxyMethods = [
        () => tryCORSProxy(url),
        () => tryWebArchive(url),
        () => tryGoogleCache(url),
        () => tryAlternativeProxy(url)
      ];
      
      let methodIndex = 0;
      tryNextMethod();
      
      function tryNextMethod() {
        if (methodIndex < proxyMethods.length) {
          proxyMethods[methodIndex]().then(() => {
            showToast('Content loaded successfully!', 'success', 'Proxy');
          }).catch(() => {
            methodIndex++;
            tryNextMethod();
          });
        } else {
          showFallbackOptions(url);
        }
      }
    }

    // CORS proxy method
    function tryCORSProxy(url) {
      return new Promise((resolve, reject) => {
        const corsProxies = [
          'https://api.allorigins.win/get?url=',
          'https://cors-anywhere.herokuapp.com/',
          'https://corsproxy.io/?',
          'https://api.codetabs.com/v1/proxy?quest='
        ];
        
        let proxyIndex = 0;
        tryCorsProxy();
        
        function tryCorsProxy() {
          if (proxyIndex < corsProxies.length) {
            const proxyUrl = corsProxies[proxyIndex] + encodeURIComponent(url);
            const iframe = document.getElementById('proxyFrame');
            iframe.src = proxyUrl;
            iframe.onload = () => resolve();
            iframe.onerror = () => {
              proxyIndex++;
              tryCorsProxy();
            };
          } else {
            reject();
          }
        }
      });
    }

    // Web Archive method
    function tryWebArchive(url) {
      return new Promise((resolve, reject) => {
        const archiveUrl = `https://web.archive.org/web/${url}`;
        const iframe = document.getElementById('proxyFrame');
        iframe.src = archiveUrl;
        iframe.onload = () => resolve();
        iframe.onerror = () => reject();
      });
    }

    // Google Cache method
    function tryGoogleCache(url) {
      return new Promise((resolve, reject) => {
        const cacheUrl = `https://webcache.googleusercontent.com/search?q=cache:${url}`;
        const iframe = document.getElementById('proxyFrame');
        iframe.src = cacheUrl;
        iframe.onload = () => resolve();
        iframe.onerror = () => reject();
      });
    }

    // Alternative proxy method
    function tryAlternativeProxy(url) {
      return new Promise((resolve, reject) => {
        const alternativeProxies = [
          `https://www.proxy-ninja.com/proxy/${encodeURIComponent(url)}`,
          `https://www.proxysite.com/ssl-proxy.php?q=${encodeURIComponent(url)}`,
          `https://www.hidemyass.com/proxy/${encodeURIComponent(url)}`
        ];
        
        let proxyIndex = 0;
        tryAltProxy();
        
        function tryAltProxy() {
          if (proxyIndex < alternativeProxies.length) {
            const iframe = document.getElementById('proxyFrame');
            iframe.src = alternativeProxies[proxyIndex];
            iframe.onload = () => resolve();
            iframe.onerror = () => {
              proxyIndex++;
              tryAltProxy();
            };
          } else {
            reject();
          }
        }
      });
    }

    // Fallback options when all methods fail
    function showFallbackOptions(url) {
      const iframe = document.getElementById('proxyFrame');
      iframe.innerHTML = `
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: white; text-align: center; padding: 20px; background: linear-gradient(135deg, #0a1222, #1a2332);">
          <h2 style="color: #64a0ff; margin-bottom: 20px;">üö´ Content Blocked</h2>
          <p style="margin-bottom: 30px; color: #8fb0d9;">The website ${url} is blocked by your network or browser.</p>
          <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center;">
            <button onclick="window.open('${url}', '_blank')" style="padding: 12px 24px; background: var(--viz); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
              Open in New Tab
            </button>
            <button onclick="tryVPN()" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
              Try VPN Mode
            </button>
            <button onclick="tryIncognito()" style="padding: 12px 24px; background: #666; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
              Try Incognito
            </button>
          </div>
          <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 20px; max-width: 600px;">
            <h4 style="color: #64a0ff; margin: 0 0 10px 0;">Blocking Detection & Evasion Tips:</h4>
            <ul style="text-align: left; margin: 0; padding-left: 20px; color: #8fb0d9; font-size: 14px;">
              <li><strong>Lightspeed/Securly:</strong> Try different proxy methods or use incognito mode</li>
              <li><strong>DNS Filtering:</strong> Use alternative DNS servers (1.1.1.1, 8.8.8.8)</li>
              <li><strong>Browser Extensions:</strong> Install ad blockers or proxy extensions</li>
              <li><strong>Mobile Data:</strong> Switch to mobile data if on school WiFi</li>
              <li><strong>Different Browsers:</strong> Try Firefox, Edge, or Opera</li>
              <li><strong>VPN Services:</strong> Use free VPN services like ProtonVPN or Windscribe</li>
            </ul>
          </div>
        </div>
      `;
      
      showToast('All proxy methods failed. Showing fallback options.', 'error', 'Proxy');
    }

    // VPN mode simulation
    function tryVPN() {
      showToast('VPN mode activated! Trying to bypass restrictions...', 'info', 'VPN');
      
      // Simulate VPN by using different user agents and headers
      const iframe = document.getElementById('proxyFrame');
      iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation allow-top-navigation-by-user-activation');
      iframe.setAttribute('referrerpolicy', 'unsafe-url');
      
      // Try loading with modified approach
      setTimeout(() => {
        const url = document.getElementById('urlBar').value;
        iframe.src = url;
      }, 1000);
    }

    // Incognito mode simulation
    function tryIncognito() {
      showToast('Opening in incognito mode...', 'info', 'Browser');
      const url = document.getElementById('urlBar').value;
      window.open(url, '_blank', 'incognito=yes');
    }

    function handleUrlInput(event) {
      if (event.key === 'Enter') {
        loadUrl();
      }
    }

    function goBack() {
      const iframe = document.getElementById('proxyFrame');
      iframe.contentWindow.history.back();
    }

    function goForward() {
      const iframe = document.getElementById('proxyFrame');
      iframe.contentWindow.history.forward();
    }

    function refreshPage() {
      const iframe = document.getElementById('proxyFrame');
      iframe.src = iframe.src;
    }

    // ===== TOAST NOTIFICATIONS =====
    function showToast(message, type = 'info', source = '') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      // Format message with source
      let formattedMessage = message;
      if (source) {
        formattedMessage = `${source} - ${message}`;
      }
      
      toast.textContent = formattedMessage;
      
      document.getElementById('toast-container').appendChild(toast);
      
      // Show toast
      setTimeout(() => toast.classList.add('show'), 100);
      
      // Hide toast after 2.5 seconds (shorter for terminal style)
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 2500);
    }

    // ===== CHANGELOGFY INTEGRATION =====
    function initializeChangelogfy() {
      const CLF_config = {
        app_id: 'vizual-network-2024',
        data: {
          user_id: 'user_' + Math.random().toString(36).substr(2, 9),
          user_email: 'user@vizualnetwork.com',
          user_name: 'VizualNetwork User',
          custom_data: {
            Plan: 'Free',
            Theme: 'Dark',
            Features: 'Games, Apps, Proxy'
          }
        }
      };
      
      window.CLF_config = CLF_config;
    }

    // ===== AD MANAGEMENT =====
    function loadAdScript() {
      if (enhancedSettings.hideAds) return;
      
      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3747175608041884';
      script.async = true;
      document.body.appendChild(script);
    }

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize enhanced features
      initializeStealthMode();
      detectBlockingSystem();
      initializeChangelogfy();
      loadAdScript();
      
      // Show welcome message
      setTimeout(() => {
        showToast('VizualNetwork Enhanced - Blocking evasion activated!', 'success', 'System');
      }, 2000);
    });

    // ===== KEYBOARD SHORTCUTS =====
    document.addEventListener('keydown', function(event) {
      // Ctrl/Cmd + K for quick proxy
      if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
        event.preventDefault();
        showProxy();
        setTimeout(() => document.getElementById('urlBar').focus(), 100);
      }
      
      // Escape to close proxy
      if (event.key === 'Escape') {
        hideProxy();
      }
    });
  </script>

  <!-- Changelogfy Script -->
  <script async src="https://widget.changelogfy.com/index.js"></script>
</body>
</html>
